{% spaceless %}
{% set datatype = datatype_tree.datatype %}

{% for data in datatype_tree.theme_elements %}

    {% set element = data.theme_element %}
    {# inverse of "if datatype_tree.is_link == 1 and element.displayinresults == 0" #}
    {% if datatype_tree.is_link == 0 or element.displayinresults == 1 %}
        {#<div id="Element_{{ element.id }}" class="ODRSortable">#}
            <div id="ThemeElement_{{ element.id }}" class="ODRThemeElement pure-u-1 pure-u-md-{{ element.getcsswidthmed }} pure-u-xl-{{ element.getcsswidthxl }}">
            {% if datatype_tree.is_link == 0 and data.datafields != null %}

            <div id="ThemeElementTools_{{ element.id }}" class="DataTypeTools pure-u-1"><span style="float:right;">
{#
                <i class="Pointer tooltip fa fa-info-circle ODRThemeElementProperties" title="ThemeElement Properties" rel="{{ element.id }}"></i>
#}
                <i class="Pointer tooltip fa {% if element.displayinresults == 1 %}fa-eye{% else %}fa-eye-slash{% endif %} ODRThemeElementVisible" title="ThemeElement{% if element.displayinresults == 0 %} not{% endif %} visible to public" rel="{{ element.id }}"></i>
{#
                <i class="Pointer tooltip fa fa-plus-square {% if data.datatype != null %}fa-muted{% endif %} ODRAddDatafield" title="Add DataField" rel="{{ datatype.id }}"></i>
                <i class="Pointer tooltip fa fa-list-alt {% if data.datatype != null or data.datafields != null %}fa-muted{% endif %} ODRAddChildtype" title="Add Child Type" rel="{{ datatype.id }}"></i>
                <i class="Pointer tooltip fa fa-link {% if data.datafields != null or (data.datatype != null and data.datatype.is_link == 0) %}fa-muted{% endif %} ODRLinkDatatype" title="Link DataType" rel="{{ datatype.id }}"></i>
                <i class="Pointer tooltip fa fa-trash-o {% if data.datafields != null or data.datatype != null %}fa-muted{% endif %} ODRDeleteThemeElement" title="Delete ThemeElement" rel="{{ element.id }}"></i>
#}
            </span></div>

            {% endif %}
    {% endif %}


    {% if datatype_tree.is_link == 1 and element.displayinresults == 0 %}
        {# don't render hidden theme_elements off linked types? #}
    {% elseif data.datafields != null %}
        {# render all datafields in this theme element #}
        {% for datafield in data.datafields %}
            {% include 'ODRAdminBundle:FieldPermissions:fieldpermissions_area_datafield.html.twig' with {'fieldtheme': datafield.theme_datafield, 'field': datafield.datafield, 'can_edit_datafields': can_edit_datafields, 'theme_element_visible': element.displayinresults, 'datafield_permissions': datafield_permissions, 'is_link': datatype_tree.is_link} %}
        {% endfor %}
    {% elseif data.datatype != null %}
        {# render the child/linked datatype in this theme element #}
        {#<div class="ODRChildDatatype">#}  {# results/record have this div, but commented out here incase it would screw up a jquery parent() chain... #}
            {% import "ODRAdminBundle:FieldPermissions:fieldpermissions_area_childtype.html.twig" as mychildform %}
            {{ mychildform.input(user, data.datatype, datatype_permissions, datafield_permissions) }}
        {#</div>#}
    {% endif %}


    {# inverse of "if datatype_tree.is_link == 1 and element.displayinresults == 0" #}
    {% if datatype_tree.is_link == 0 or element.displayinresults == 1 %}
            </div><!-- End of .ThemeElement -->
        {#</div><!-- End of #Element_{{ element.id }} -->#}
    {% endif %}

{% endfor %}


{% if datatype_tree.is_link == 0 and datatype_tree.fieldarea_reload == 0 %}
    {#</div><!-- End of .SortableColumn -->#}
{% endif %}
{% endspaceless %}
