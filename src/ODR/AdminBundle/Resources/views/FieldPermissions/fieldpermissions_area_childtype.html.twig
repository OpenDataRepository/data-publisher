{% macro input(user, datatype_tree, datatype_permissions, datafield_permissions) %}
{% spaceless %}

{% set datatype = datatype_tree.datatype %}

{% set can_edit_datafields = false %}
{% if datatype_permissions[ datatype.id ] is defined %}
    {% if datatype_permissions[ datatype.id ][ 'edit' ] is defined %}
        {% set can_edit_datafields = true %}
    {% endif %}
{% endif %}

<div class="ODRDataType{% if datatype_tree.is_link == 1 %} ODRLinkedType{% endif %}{% if datatype_tree.top_level == 0 %} ODRAccordionWrapper ODRFormAccordion{% endif %} pure-u-1" id="DataType_{{ datatype.id }}" rel="{{ datatype_tree.theme_datatype.id }}">

    {% if datatype_tree.top_level == 0 %}
        {# current datatype is a child or linked datatype #}
        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active ui-corner-top" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
            <span class="ui-icon ui-icon-triangle-1-s"></span>
            <a id="Datatype_{{ datatype.id }}_ShortName">{{ datatype.shortname }}</a>

            {% if datatype_tree.is_link == 0 %}
            <span id="DataTypeTools_{{ datatype.id }}" class="DataTypeTools" style="float:right;" rel="{{ datatype.id }}">
                <i class="Pointer tooltip fa {% if can_edit_datafields == true %}fa-unlock{% else %}fa-lock{% endif %} ODREditPermission" title="User is {% if can_edit_datafields == false  %}not {% endif %}permitted to edit this Datatype" rel="{{ user.id }}"></i>
            </span>
            {% endif %}

        </h3>

        <div class="ODRFieldArea accordion-content pure-u-1" id="FieldArea_{{ datatype.id }}">
            {% include 'ODRAdminBundle:FieldPermissions:fieldpermissions_area_fieldarea.html.twig' with {'user': user, 'datatype_tree': datatype_tree, 'can_edit_datafields': can_edit_datafields, 'datatype_permissions': datatype_permissions, 'datafield_permissions': datafield_permissions} %}
        </div><!-- End of #FieldArea_{{ datatype.id }} -->
    {% else %}
        {# current datatype is top-level #}
        {% if datatype_tree.is_link == 0 %}
        <span id="DataTypeTools_{{ datatype.id }}" class="DataTypeTools" style="float:right;" rel="{{ datatype.id }}">
            <i class="Pointer tooltip fa {% if can_edit_datafields == true %}fa-unlock{% else %}fa-lock{% endif %} ODREditPermission" title="User is {% if can_edit_datafields == false  %}not {% endif %}permitted to edit this Datatype" rel="{{ user.id }}"></i>
        </span>
        {% endif %}

        <div class="header">
            <h3 id="Datatype_{{ datatype.id }}_ShortName">{{ datatype.shortname }}</h3>
        </div>

        <div class="ODRFieldArea pure-u-1" id="FieldArea_{{ datatype.id }}">
            {% include 'ODRAdminBundle:FieldPermissions:fieldpermissions_area_fieldarea.html.twig' with {'user': user, 'datatype_tree': datatype_tree, 'can_edit_datafields': can_edit_datafields, 'datatype_permissions': datatype_permissions, 'datafield_permissions': datafield_permissions} %}
        </div><!-- End of #FieldArea_{{ datatype.id }} -->

    {% endif %}

</div><!-- End of #DataType_{{ datatype.id }} -->

{% endspaceless %}
{% endmacro %}
