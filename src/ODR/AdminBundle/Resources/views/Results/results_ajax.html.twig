{% spaceless %}

{% set datatype = datatype_tree.datatype %}

<h1 class="no-margin-top-phone">
    <span>Search Result &raquo; {{ datatype.shortname }}</span>
</h1>

{% include 'ODRAdminBundle:Results:results_area.html.twig' with {'datatype_tree': datatype_tree, 'datarecord_tree': datarecord_tree, 'theme': theme, 'public_only': public_only} %}

<script>

$(function() {
    initPage();
    $(".MenuDesignArea").remove();
    window.scrollTo(0,0);
});

function initPage() {

    // Resize all elements dependent on window size
    $(window).unbind('resize');
    $(window).resize(function() {
        WindowResizeInterval = window.clearInterval(WindowResizeInterval);
        WindowResizeInterval = window.setInterval("onWindowResize()", 500);
    });

    // Resize everything prior to divs being hidden
    onWindowResize();

    // Set up image galleries
    setupImageGalleries();

    // Hide divs for accordion purposes
    setupAccordions();

    // Hide empty theme element divs
    $(".ODRThemeElement").each(function() {
        var has_children = false;
        $(this).find(".ODRFieldArea").each(function() {
            has_children = true;
        });

        $(this).find(".ODRDataField").each(function() {
            has_children = true;
        });

        if (!has_children)
            $(this).css( "display", "none" );
    });

    $(".ODRFileDownloadProgress").hide();

    $("a.ODRFileDownload").unbind('click');
    $("a.ODRFileDownload").click(function(event) {
        // Grab necessary attributes
        var file_id = $(this).attr('rel');
        var href = $(this).attr('href');

        var short_form = false;
        handleFileDownload(event, file_id, href, short_form);
    });
}

function ReloadDatafield(datarecord_id, datafield_id) {
    var url = '{{ path('odr_results_reload_datafield', { 'datarecord_id': 0, 'datafield_id': 0 }) }}';
    url = url.substring(0, (url.length-3));
    url += datarecord_id + '/' + datafield_id;

//alert( url );
//return;

    var datafield_div = $("#Field_" + datarecord_id + "_" + datafield_id);

    $(datafield_div).children('form').each(function() {
        $(this).fadeOut();
        $(this).remove();
    });

    $.ajax({
        cache: false,
        type: 'GET',
        url: url,
        dataType: "json",
        success: function(data, textStatus, jqXHR) {
            if (data.r == 0) {
                $(datafield_div).append(data.d.html);
                initPage();
            }
            else {
                alert( data.d );
            }
        },
        complete: function(jqXHR, textStatus) {
            // Get the xdebugToken from response headers
            var xdebugToken = jqXHR.getResponseHeader('X-Debug-Token');

            // If the Sfjs object exists
            if (typeof Sfjs !== "undefined") {
                // Grab the toolbar element
                var currentElement = $('.sf-toolbar')[0];

                // Load the data of the given xdebug token into the current toolbar wrapper
                Sfjs.load(currentElement.id, '/app_dev.php/_wdt/'+ xdebugToken);
            }
        }
    });
}
</script>
{% endspaceless %}
