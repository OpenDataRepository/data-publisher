{% spaceless %}

{% set new_fieldtype_can_be_unique = new_fieldtype.canBeUnique %}
{# NOTE: the conversions sent through this twig file don't lose data, so they won't create duplicates in unique fields #}
{% set new_fieldtype_can_be_sort_field = new_fieldtype.canBeSortField %}

<div>
    {% set dt = df.getdatatype %}

    {% if df.getisunique %}
        <div class="bold{% if not new_fieldtype_can_be_unique %} ODRInputError{% endif %}">
            This datafield is currently marked as unique{% if not new_fieldtype_can_be_unique %}, but won't be after migrating to this fieldtype{% endif %}.
            {% if not new_fieldtype_can_be_unique %}&nbsp;<label class="ODRMigration_acknowledge"><input type="checkbox" />&nbsp;Acknowledged?</label>{% endif %}
        </div>
    {% endif %}

    {% set external_id_field = dt.getexternalidfield %}
    {% if external_id_field is not null and external_id_field.id == df.id %}
        <div class="bold{% if not new_fieldtype_can_be_unique %} ODRInputError{% endif %}">
            This datafield is currently the datatype's external id field{% if not new_fieldtype_can_be_unique %}, but won't be after migrating to this fieldtype{% endif %}.
            {% if not new_fieldtype_can_be_unique %}&nbsp;<label class="ODRMigration_acknowledge"><input type="checkbox" />&nbsp;Acknowledged?</label>{% endif %}
        </div>
    {% endif %}

    {% if df.getnamedatatypes|length > 0 %}
        {% for dt in df.getnamedatatypes %}
        <div class="bold{% if not new_fieldtype_can_be_sort_field %} ODRInputError{% endif %}">
            This datafield is currently used in naming records of the "{{ dt.getshortname }}" datatype{% if not new_fieldtype_can_be_sort_field %}, but won't be after migrating to this fieldtype{% endif %}.
            {% if not new_fieldtype_can_be_sort_field %}&nbsp;<label class="ODRMigration_acknowledge"><input type="checkbox" />&nbsp;Acknowledged?</label>{% endif %}
        </div>
        {% endfor %}
    {% endif %}
    {% if df.getsortdatatypes|length > 0 %}
        {% for dt in df.getsortdatatypes %}
        <div class="bold{% if not new_fieldtype_can_be_sort_field %} ODRInputError{% endif %}">
            This datafield is currently used in sorting records of the "{{ dt.getshortname }}" datatype{% if not new_fieldtype_can_be_sort_field %}, but won't be after migrating to this fieldtype{% endif %}.
            {% if not new_fieldtype_can_be_sort_field %}&nbsp;<label class="ODRMigration_acknowledge"><input type="checkbox" />&nbsp;Acknowledged?</label>{% endif %}
        </div>
        {% endfor %}
    {% endif %}

    {% if render_plugin_restrictions[df.id] is defined and render_plugin_restrictions[df.id]['affected_by_render_plugin'] == true %}
        <div class="bold{% if new_fieldtype.id not in render_plugin_restrictions[df.id]['allowed_fieldtypes'] %} ODRInputError{% endif %}">
            This datafield is currently used by a render plugin{% if new_fieldtype.id not in render_plugin_restrictions[df.id]['allowed_fieldtypes'] %}, and can't be migrated to this fieldtype because the render plugin would stop working{% endif %}.
            {% if new_fieldtype.id not in render_plugin_restrictions[df.id]['allowed_fieldtypes'] %}&nbsp;<label class="ODRMigration_acknowledge">{# can't acknowledge this #}</label>{% endif %}
        </div>
    {% endif %}

    <div class="ODRDatarecordListHeader{% if 'will be lost' in html or 'will lose' in html %} ODRInputError{% endif %}">
        {{ html }}
        {% if 'will be lost' in html or 'will lose' in html %}&nbsp;<label class="ODRMigration_acknowledge"><input type="checkbox" />&nbsp;Acknowledged?</label>{% endif %}
    </div>
{# TODO - this is temporary, so I can commit the updated reports files without also having to implement the update to fieldtype migration...
    {% if 'is already a' not in html %}
    <br>
    <div>
        <div class="pure-button pure-button-primary pure-button-disabled ODRMigration_confirm">Begin Migration</div>
    </div>
    {% endif %}
#}
</div>
{% endspaceless %}
