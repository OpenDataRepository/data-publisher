{% macro input(datatype_tree, datarecord_tree, theme, datatype_permissions, datafield_permissions) %}
{% spaceless %}

{% set datatype = datatype_tree.datatype %}

{% set can_edit_record = 0 %}
{% set can_add_record = 0 %}
{% set can_delete_record = 0 %}
{% if datatype_permissions[ datatype.id ] is defined and datatype_permissions[ datatype.id ][ 'edit' ] is defined %}
    {% set can_edit_record = 1 %}
{% endif %}
{% if datatype_permissions[ datatype.id ] is defined and datatype_permissions[ datatype.id ][ 'add' ] is defined %}
    {% set can_add_record = 1 %}
{% endif %}
{% if datatype_permissions[ datatype.id ] is defined and datatype_permissions[ datatype.id ][ 'delete' ] is defined %}
    {% set can_delete_record = 1 %}
{% endif %}

<!-- Child Types -->
<div class="ODRDataType pure-u-1" id="DataType_{{ datatype.id }}" rel="{{ datatype_tree.theme_datatype.id }}">

    {% include 'ODRAdminBundle:Default:accordion_header.html.twig' with {'datatype_tree': datatype_tree, 'datarecord_tree': datarecord_tree, 'public_only': false} %}

    {% for dr_entry in datarecord_tree %}
        {% set datarecord = dr_entry.datarecord %}

{#
----------</br>
datarecord: {{ datarecord.id }} </br>
top_level: {{ datatype_tree.top_level }} </br>
display_type: {{ datatype.getdisplaytype }} </br>
is_public: {{ datarecord.ispublic }} </br>
public_only: {{ public_only}} </br>
----------</br>
#}

        {#{% if datatype_tree.top_level == 0 and datatype.getdisplaytype == 0 %}#}
        {% if datatype_tree.top_level == 0 and (datatype.getdisplaytype == 0 or datatype.getdisplaytype == 3) %}
            <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active ui-corner-top" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
                <span class="ui-icon ui-icon-triangle-1-s"></span>
                {% set datarecord_name = datarecord.getnamefieldvalue %}
                {% if datarecord_name != datarecord.id %}
                    <a>{{ datarecord_name }}</a>
                {% else %}
                    <a>{{ datatype.shortname }}</a>
                {% endif %}

                {% if datarecord.grandparent != null %}
                    <span style="float: right;" rel="{{ datatype.id }}">
                        <i id="datarecord_{{ datarecord.id }}_public" class="tooltip fa fa-lg fa-globe {% if datarecord.ispublic == false %}IconRed{% endif %} {% if datatype_tree.is_link == 0 and can_edit_record == 1 %}Pointer ODRPublicChildRecord{% endif %}" title="{% if datatype_tree.is_link == 1 %}Linked{% else %}Child{% endif %} Record is {% if datarecord.ispublic == false %}not {% endif %}Public" rel="{{ datarecord.id }}"></i>

                    {% if datatype_tree.is_link == 0 and can_delete_record == 1 %}
                        <i class="Pointer tooltip fa fa-times fa-lg ODRDeleteChildRecord" title="Delete Child Record" rel="{{ datarecord.id }}"></i>
                    {% endif %}

                    {% if datatype_tree.is_link == 1 and can_edit_record == 1 %}
                        <a target="_blank" class="Pointer" onclick="UpdateURL('#{{ path('odr_record_edit', {'datarecord_id': datarecord.id}) }}');" style="margin-left: 5px;"><strong>Edit</strong></a>
                        {#<a target="_blank" class="Pointer ODROpenLinkedRecord" style="margin-left: 5px;" rel="{{ datarecord.id }}"><strong>Edit</strong></a>#}
                    {% endif %}
                    </span>
                {% endif %}
            </h3>
        {% endif %}

        <div class="ODRFieldArea accordion-content pure-u-1" id="FieldArea_{{ datarecord.id }}">
            {% include 'ODRAdminBundle:Record:record_fields.html.twig' with {'datatype_tree': datatype_tree, 'dr_entry': dr_entry, 'theme': theme, 'datatype_permissions': datatype_permissions, 'datafield_permissions': datafield_permissions} %}
        </div><!-- End of #FieldArea_{{ datarecord.id }} -->

    {% endfor %}


    {% include 'ODRAdminBundle:Default:accordion_footer.html.twig' with {'childtype': datatype } %}

</div><!-- End of #DataType_{{ datatype.id }} -->

{% endspaceless %}
{% endmacro %}
