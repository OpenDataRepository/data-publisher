{% spaceless %}

<div class="header">
    <h2>User Profile{% if target_user != null %} - {{ target_user.getuserstring }}{% endif %}
        <span id="saved">&nbsp;&nbsp;&nbsp;SAVED</span>
    </h2>
</div>


{{ form_start(profile_form, {
    'method': 'POST',
    'attr': {
        'id': 'ODRUserProfileForm_' ~ target_user.id,
        'class': 'ODRUserProfileForm pure-form pure-form-aligned'
    }
}) }}

    <fieldset>

        <div class="pure-control-group">
            <label for="{{ profile_form.email.vars.id }}">
                <strong>{{ profile_form.email.vars.label }}</strong>
            </label>
            {{ form_errors(profile_form.email) }}
            {{ form_widget(profile_form.email, { 'attr': {'class': 'required', 'data-error-type': 'inline', 'disabled': 'disabled'} }) }}
        </div>

        <div class="pure-control-group">
{% if current_user.id == target_user.id %}
            <a class="address pure-button" href="{{ path('fos_user_change_password') }}" >Change Password</a>
{% else %}
            <a class="address pure-button" href="#{{ path('odr_admin_change_password', {'user_id': target_user.id}) }}" >Change Password</a>
{% endif %}
        </div>

        <div>&nbsp;</div>

        <div class="pure-control-group">
            <label for="{{ profile_form.firstName.vars.id }}">
                <strong>{{ profile_form.firstName.vars.label }}</strong>
            </label>
            {{ form_errors(profile_form.firstName) }}
            {{ form_widget(profile_form.firstName, { 'attr': {'class': '', 'data-error-type': 'inline' } }) }}
        </div>
        <div class="pure-control-group">
            <label for="{{ profile_form.lastName.vars.id }}">
                <strong>{{ profile_form.lastName.vars.label }}</strong>
            </label>           
            {{ form_errors(profile_form.lastName) }}
            {{ form_widget(profile_form.lastName, { 'attr': {'class': '', 'data-error-type': 'inline' } }) }}
        </div>

        <div>&nbsp;</div>

        <div class="pure-control-group">
            <label for="{{ profile_form.institution.vars.id }}">
                <strong>{{ profile_form.institution.vars.label }}</strong>
            </label>
            {{ form_errors(profile_form.institution) }}
            {{ form_widget(profile_form.institution, { 'attr': {'class': '', 'data-error-type': 'inline' } }) }}
        </div>
        <div class="pure-control-group">
            <label for="{{ profile_form.position.vars.id }}">
                <strong>{{ profile_form.position.vars.label }}</strong>
            </label>
            {{ form_errors(profile_form.position) }}
            {{ form_widget(profile_form.position, { 'attr': {'class': '', 'data-error-type': 'inline' } }) }}
        </div>
        <div class="pure-control-group">
            <label for="{{ profile_form.phoneNumber.vars.id }}">
                <strong>{{ profile_form.phoneNumber.vars.label }}</strong>
            </label>
            {{ form_errors(profile_form.phoneNumber) }}
            {{ form_widget(profile_form.phoneNumber, { 'attr': {'class': '', 'data-error-type': 'inline' } }) }}
        </div>

        <div style="display: none">
            {{ form_rest(profile_form) }}
        </div>
    </fieldset>

    {#<input class="pure-button pure-button-primary" type="button" value="Save" onclick="saveProfileForm();" />#}
    <button class="pure-button pure-button-primary" onclick="saveProfileForm();">Save</button>

{{ form_end(profile_form) }}

<script>
    $(function() {
        $("#saved").hide();
    });

    function saveProfileForm() {

{% if self_edit == 'true' %}
        var url = "{{ path('odr_self_profile_save') }}";
{% else %}
        var url = "{{ path('odr_profile_save') }}";
{% endif %}

        $.ajax({
            url: url,
            type: 'POST',
            dataType: 'json',
            data: $("#ODRUserProfileForm_{{ target_user.id }}").serialize(),
            success: function(data, textStatus, jqXHR) {
                if (data.r == 0) {
                    $('#saved').fadeIn();
                    setTimeout(function() {
                        $('#saved').fadeOut();
                    }, 2500);
                }
                else {
                    // Error in form
                    alert(data.d.html);
//                    window.location.reload();
                }
            },
            complete: function(jqXHR, textStatus) {
                // Get the xdebugToken from response headers
                var xdebugToken = jqXHR.getResponseHeader('X-Debug-Token');

                // If the Sfjs object exists
                if (typeof Sfjs !== "undefined") {
                    // Grab the toolbar element
                    var currentElement = $('.sf-toolbar')[0];

                    // Load the data of the given xdebug token into the current toolbar wrapper
                    Sfjs.load(currentElement.id, '/app_dev.php/_wdt/'+ xdebugToken);
                }
            }
        });
    }
</script>

{% endspaceless %}
