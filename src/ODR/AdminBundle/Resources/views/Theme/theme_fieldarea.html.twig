{% spaceless %}

    {% set datatype = datatype_array[target_datatype_id] %}
    {% set theme = datatype.themes[theme_id] %}

    {% for theme_element in theme.themeElements %}

        {% set has_datafields = false %}
        {% set has_childtype = false %}
        {% set child_is_link = false %}
        {% if theme_element.themeDataFields is defined %}
            {% set has_datafields = true %}
        {% elseif theme_element.themeDataType is defined %}
            {% set has_childtype = true %}

            {% if theme_element.themeDataType[0].is_link == 1 %}
                {% set child_is_link = true %}
            {% endif %}
        {% endif %}

        <div id="ThemeElement_{{ theme_element.id }}" class="ODRThemeElement pure-u-1 pure-u-md-{{ theme_element.themeElementMeta.cssWidthMed }} pure-u-xl-{{ theme_element.themeElementMeta.cssWidthXL }}">
            <div class="ODRInnerBox">

                {% if theme_element.themeDataFields is defined %}
                    {# render all datafields in this theme element #}
                    {% for theme_datafield in theme_element.themeDataFields %}
                        {% set datafield = theme_datafield.dataField %}

                        {% include 'ODRAdminBundle:Theme:theme_datafield.html.twig' with {
                        'theme_datafield': theme_datafield,
                        'datafield': datafield,

                        'is_datatype_admin': is_datatype_admin,
                        } %}

                    {% endfor %}
                {% elseif theme_element.themeDataType is defined %}

                    {% for theme_datatype in theme_element.themeDataType %}     {# only ever going to be one, for right now... #}
                        {% set child_datatype = theme_datatype.dataType %}

                        {% if datatype_array[ child_datatype.id ] is defined %}
                            {% set child_theme_id = 0 %}
                            {% for theme in datatype_array[ child_datatype.id ].themes %}
                                {% if theme.themeType == 'master' %}
                                    {% set child_theme_id = theme.id %}
                                {% endif %}
                            {% endfor %}

                            {% include 'ODRAdminBundle:Theme:theme_childtype.html.twig' with {
                            'datatype_array': datatype_array,
                            'target_datatype_id': child_datatype.id,
                            'theme_id': child_theme_id,

                            'is_datatype_admin': is_datatype_admin,

                            'is_top_level': 0,
                            'is_link': theme_datatype.is_link,
                            } %}
                        {% endif %}
                    {% endfor %}

                {% endif %}

            </div><!-- End of .ODRInnerBox -->
        </div><!-- End of #ThemeElement_{{ theme_element.id }} -->

    {% endfor %}

{% endspaceless %}