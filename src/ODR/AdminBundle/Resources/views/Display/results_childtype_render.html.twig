{#
{% macro input(parent_data_record_id, data_record_id, data_record_array, linked_data_array, theme_data_by_type) %}
#}
{% spaceless %}

{% set current_data_record = data_record_array[parent_data_record_id][data_record_id] %}
{% set datatype = data_record_array[parent_data_record_id][data_record_id].dataType %}
{% set render_plugin = datatype.renderPlugin %}


{% if render_plugin.overrideChild %}
    {# render_plugin html already displayed from results_fields.html.twig #}

    {# TODO Fix this to display proper accordion headers for render plugins. #}
    {% include 'ODRAdminBundle:DefaultNew:accordion_header.html.twig' with {'datatype': datatype, 'parent_data_record_id': parent_data_record_id, 'current_data_record': current_data_record, 'data_record_array': data_record_array} %}
    {# Override Child:: {{ current_data_record.dataType.id }} || {{ datatype.id }} #}

    {% if render_plugin.overrideFields %}

        {# TODO -- Repeat the following loop using the linked_data array #}
        {% for dr_entry in datarecord_tree %}
            {% set datarecord = dr_entry.datarecord %}

            {% if datatype_tree.top_level == 0 and datatype.getdisplaytype == 0 and (datarecord.ispublic == true or public_only == false) %}
                <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
                    <span class="ui-icon ui-icon-triangle-1-s"></span>
                    {% set datarecord_name = datarecord.getnamefieldvalue %}
                    {% if datarecord_name != datarecord.id %}
                        <a>{{ datarecord_name }}</a>
                    {% else %}
                        <a>{{ datatype.shortname }}</a>
                    {% endif %}

                    {% if public_only == false and datarecord.grandparent != null %}
                        <span style="float: right;">
                            <i class="tooltip fa fa-lg fa-globe {% if datarecord.ispublic == false %}IconRed{% endif %}" title="{% if datatype_tree.is_link == 1 %}Linked{% else %}Child{% endif %} Record is {% if datarecord.ispublic == false %}not {% endif %}Public" rel="{{ datarecord.id }}"></i>
                        </span>
                    {% endif %}

                </h3>
            {% endif %}

            <div class="ODRFieldArea accordion-content pure-u-1" id="FieldArea_{{ datarecord.id }}">
                {% include 'ODRAdminBundle:Display:results_fields.html.twig' with {'data_record_array': data_record_array, 'datarecord': datarecord, 'datatype': datarecord.dataType, 'theme': theme_data_by_type} %}
            </div><!-- End of #FieldArea_{{ datarecord.id }} -->
        {% endfor %}
    {% else %}
        <div class="ODRFieldArea">
            CHILD TYPE RENDER PLUGIN should render here (overrideChild = true, overrideFields = false)
        </div>
    {% endif %}

    {% include 'ODRAdminBundle:DefaultNew:accordion_footer.html.twig' with {'childtype': datatype} %}

{% else %}
    <!-- Child Types -->
    <div id="DataType_{{ datatype.id }}" class="ODRDataType pure-u-1" rel="{# datatype_tree.theme_datatype.id #}">
        {% include 'ODRAdminBundle:DefaultNew:accordion_header.html.twig' with {'datatype': datatype, 'parent_data_record_id': parent_data_record_id, 'current_data_record': current_data_record, 'data_record_array': data_record_array} %}

        {#
        ----------</br>
        datarecord: {{ datarecord.id }} </br>
        top_level: {{ datatype_tree.top_level }} </br>
        display_type: {{ datatype.getdisplaytype }} </br>
        is_public: {{ datarecord.ispublic }} </br>
        public_only: {{ public_only}} </br>
        ----------</br>
        #}
        {% for datarecord in data_record_array[parent_data_record_id] %}
            {# NON Override Child:: {{ datarecord.dataType.id }} || {{ datatype.id }} #}
            {% if datarecord.dataType.id == datatype.id %}
                {% if data_record_id == parent_data_record_id and datatype.display_type == 0 and datarecord.publicDate.date <= "now"|date("YMd h:i:s")  %}
                    <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
                    <span class="ui-icon ui-icon-triangle-1-s"></span>
                    {% set datarecord_name = datarecord.namefield_value %}
                    {% if datarecord_name != datarecord.id %}
                        <a>{{ datarecord_name }}</a>
                    {% else %}
                        <a>{{ datatype.short_name }}</a>
                    {% endif %}

                    {% if datarecord.publicDate.date <= "now"|date("YMd h:i:s") and datarecord.grandparent.id != null %}
                        <span style="float: right;">
                            {# <i class="tooltip fa fa-lg fa-globe {% if datarecord.ispublic == false %}IconRed{% endif %}" title="{% if datatype_tree.is_link == 1 %}Linked{% else %}Child{% endif %} Record is {% if datarecord.ispublic == false %}not {% endif %}Public" rel="{{ datarecord.id }}"></i> #}
                        </span>
                    {% endif %}
                    </h3>
            {% endif %}

                {#
            {% if datarecord.publicDate.date <= "now"|date("YMd h:i:s") %}
                #}
            <div class="ODRFieldArea accordion-content pure-u-1" id="FieldArea_{{ datarecord.id }}">
                {% if render_plugin.id != '1' %}
                    <!-- render_plugin html -->
                    {# dr_entry.render_plugin_html|raw #}
                    {% if render_plugin.overrideFields == 0 %}
                        <!-- render_plugin fields -->
                        {% include 'ODRAdminBundle:Display:results_fields.html.twig' with {'data_record_array': data_record_array, 'datarecord': datarecord, 'datatype': datarecord.dataType, 'theme': theme_data_by_type} %}
                    {%  else  %}
                        {% include 'ODRAdminBundle:Display:results_fields.html.twig' with {'data_record_array': data_record_array, 'datarecord': datarecord, 'datatype': datarecord.dataType, 'theme': theme_data_by_type} %}
                    {% endif %}
                {% else %}
                    <!-- default render html -->
                    {# include 'ODRAdminBundle:Display:results_fields.html.twig' with {'data_record': data_record[current_data_record.id], 'datarecord': datarecord, 'datatype': datatype, 'theme': theme_data_by_type} #}
                    {% include 'ODRAdminBundle:Display:results_fields.html.twig' with {'data_record_array': data_record_array, 'datarecord': datarecord, 'datatype': datarecord.dataType, 'theme': theme_data_by_type} %}
                {% endif %}
            </div><!-- End of #FieldArea_{{ datarecord.id }} -->
                {#
                {% endif %}
                #}
            {% endif %}

        {% endfor %}

        {% include 'ODRAdminBundle:DefaultNew:accordion_footer.html.twig' with {'childtype': datatype} %}

    </div><!-- End of #DataType_{{ datatype.id }} -->
{% endif %}

{% endspaceless %}
{#
{% endmacro %}
#}
