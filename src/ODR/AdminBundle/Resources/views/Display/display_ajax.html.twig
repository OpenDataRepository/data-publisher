{% spaceless %}

{% set datatype = datatype_array[initial_datatype_id] %}
{% set theme = theme_array[initial_theme_id] %}

{% if record_display_view == "single" %}

    {% include 'ODRAdminBundle:Default:view_manager.html.twig' with {
        'datatype': datatype,
        'theme': theme,
        'page_type': 'display',
        'search_key': search_key,
    } %}

{# End Record View Menu #}
{% endif %}

{% include 'ODRAdminBundle:Display:display_area.html.twig' with {
    'datatype_array': datatype_array,
    'datarecord_array': datarecord_array,
    'theme_array': theme_array,

    'initial_datatype_id': initial_datatype_id,
    'initial_datarecord_id': initial_datarecord_id,
    'initial_theme_id': initial_theme_id,

    'is_top_level': is_top_level,
} %}

{% if record_display_view == "single" %}
    {% include 'ODRAdminBundle:Default:file_download_dialog.html.twig' %}
{% endif %}

{% if record_display_view == "single" %}
<script>

    function initPage() {

        // TODO What is this for?
        // Resize all elements dependent on window size
        $(window).unbind('resize').resize(function() {
            // WindowResizeInterval variable defined in common.js
            // WindowResizeInterval = window.clearInterval(WindowResizeInterval);
            // WindowResizeInterval = window.setInterval("onWindowResize()", 500);
        });

        // Resize everything prior to divs being hidden
        // onWindowResize();

        // Set up image galleries
        setupImageGalleries();

        // Hide divs for accordion purposes
        setupAccordions();

        // Setup File Downloader
        setupFileDownloader();
    }

    function setupFileDownloader() {

        $(".ODRFileDownloadProgress").hide();

        $("a.ODRFileDownload").unbind('click').click(function(event) {
            // Grab necessary attributes
            var file_id = $(this).attr('rel');

            handleFileDownload(event, file_id);    // defined in Default::file_handling.html.twig
        });

        $(".ODRDownloadAllFiles").unbind('click').click(function() {

            if ( $(this).hasClass('fa-muted') )
                return;

            // Grab necessary attributes
            var element = $(this);

            var id_data = $(this).closest(".ODRDataField").first().attr('id').split(/_/);
            var datarecord_id = id_data[1];
            var datafield_id = id_data[2];

            // defined in ODRAdminBundle:Default:file_download_dialog.html.twig
            openFileDownloadDialog({{ initial_datarecord_id }}, datarecord_id, datafield_id);
        });
    }

    $(function() {
        initPage();

        // $(".MenuDesignArea").remove();
        window.scrollTo(0,0);
    });
{% endif %}

</script>
{% endspaceless %}
