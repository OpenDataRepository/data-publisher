{% spaceless %}


{# switch to using current_data_record #}
{# Check if has children other than itself #}
{% set has_children = false %}
{% if (
    data_record_array[parent_data_record_id] is defined
        and (
            (data_record_array[parent_data_record_id][current_data_record.id] is defined and data_record_array[parent_data_record_id]|length > 1)
            or (data_record_array[parent_data_record_id][current_data_record.id] is not defined)
        )
    )
%}
    {% set has_children = true %}
{% endif %}

{% if datatype.display_type == 0 %}
    <!-- Begin FormAccordion Type 0 {{ datatype.id }} -->
    <div class="ODRAccordionWrapper ODRFormAccordion">
{% elseif datatype.display_type == 1 %}
    <!-- Begin FormAccordion Type 1 {{ datatype.id }} -->
    <div class="ODRAccordionWrapper ODRTabAccordion">
    {% if has_children == true %}
        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active ui-corner-top" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
            <span class="ui-icon ui-icon-triangle-1-s"></span>
            <a>{{ datatype.shortName }}</a>
        </h3>

        <div class="pure-u-1 ODRTabButtonHeader">
        {% for datarecord in data_record_array[parent_data_record_id] %}
            {# if datarecord.public_date <= "now"|date("YMd h:i:s")  #}
            {% if datarecord.dataType.id == datatype.id  %}
                {% if datarecord.namefield_value == "" %}
                    <button class="pure-button ODRTabButton" rel="{{ datarecord.id }}">{{ datarecord.id }}</button>
                {%  else  %}
                    <button class="pure-button ODRTabButton" rel="{{ datarecord.id }}">{{ datarecord.namefield_value }}</button>
                {% endif %}
            {% endif %}
        {% endfor %}
        </div>
    {% endif %}

{% elseif datatype.display_type == 2 %}
    <!-- Begin FormAccordion Type 2 {{ datatype.id }} -->
    <div class="ODRAccordionWrapper ODRDropdownAccordion">
    {% if has_children == true %}
        <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-state-active ui-corner-top" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
            <span class="ui-icon ui-icon-triangle-1-s"></span>
            <a>{{ datatype.shortName }}</a>

            <span style="float:right;">
                <select id="DataType_{{ datatype.id }}_dropdown" class="accordion" style="padding: 0.6em 0.78em;">
                {% for datarecord in data_record[parent_data_record.id] %}
                    {# if datarecord.public_date <= "now"|date("YMd h:i:s")  #}
                    {% if datarecord.dataType.id == datatype.id  %}
                        {% if datarecord.namefield_value == "" %}
                            <option value="{{ datarecord.id }}">{{ datarecord.id }}</option>
                        {%  else  %}
                            <option value="{{ datarecord.id }}">{{ datarecord.namefield_value }}</option>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                </select>
            </span>
        </h3>
    {% endif %}

{% elseif datatype.display_type == 3 %}
    {# just a header here...accordiong_footer.html.twig doesn't need a closing tag #}
    <h3 class="ODRListDisplayHeader ui-accordion-header ui-helper-reset ui-state-default ui-state-active" role="tab" aria-expanded="true" aria-selected="true" tabindex="0">
        <a>{{ datatype.shortName }}</a>
    </h3>

{% endif %}

{# closing div tag for all of these is in accordion_footer.html.twig #}
{% endspaceless %}
