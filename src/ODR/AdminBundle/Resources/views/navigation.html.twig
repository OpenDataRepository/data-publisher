{% block navigation_top %}

{% set level = 0 %}
{% for role in user.getroles %}
    {% if role == 'ROLE_SUPER_ADMIN' %}
        {% set level = level + 4 %}
    {% elseif role == 'ROLE_ADMIN' %}
        {% set level = level + 2 %}
    {% elseif role == 'ROLE_USER' %}
        {% set level = level + 1 %}
    {% endif %}
{% endfor %}

{% set is_datatype_admin = false %}
{% if level == 7 %}
    {% set is_datatype_admin = true %}
{% else %}
    {% for datatype_id, permissions in user_permissions %}
        {% if user_permissions[ datatype_id ][ 'dt_admin' ] is defined %}
            {% set is_datatype_admin = true %}
        {% endif %}
    {% endfor %}
{% endif %}


<nav class="pure-menu pure-menu-open">
    <ul>
        <li><a id="ODRMenu_dashboard" href="{{ path('odr_admin_homepage') }}"><i class="fa fa-lg fa-dashboard fa-fw"></i>Dashboard</a></li>
        <li><a id="ODRMenu_profile" class="address" href="#{{ path('odr_self_profile_edit') }}"><i class="fa fa-lg fa-user fa-fw"></i>Profile</a></li>
        <li><a id="ODRMenu_joblist" class="address" href="#{{ path('odr_job_list') }}"><i class="fa fa-lg fa-cogs fa-fw"></i>Active Jobs</a></li>

        <li class="pure-menu-separator"></li>

        <li><a id="ODRMenu_listrecords" class="address" href="#{{ path('odr_list_types', { 'section': 'records' } ) }}" title="List Records"><i class="fa fa-lg fa-fw fa-list"></i>List Records</a></li>
        <li><a id="ODRMenu_listtypes" class="address" href="#{{ path('odr_list_types', { 'section': 'design' } ) }}" title="List Databases"><i class="fa fa-lg fa-fw fa-cog"></i>List Databases</a></li>

{% if is_datatype_admin == true %}
        <li class="ODRMenuExpand Pointer">
            <a><i class="fa fa-lg fa-group fa-fw"></i>User Management</a>
            <ul>
                <li><a id="ODRMenu_listusers" class="address" href="#{{ path('odr_user_list') }}" title="List Users"><i class="fa fa-lg fa-fw fa-cog"></i>List Users</a></li>
            {% if level == 3 or level == 7 %}
                <li><a id="ODRMenu_adduser" class="address" href="#{{ path('odr_admin_new_user_create') }}" title="Add User"><i class="fa fa-lg fa-fw fa-cog"></i>Add User</a></li>
            {% endif %}
            {% if level == 7 %}
                <li><a id="ODRMenu_manageroles" class="address" href="#{{ path('odr_manage_user_roles') }}" title="Manage Roles"><i class="fa fa-lg fa-fw fa-cog"></i>Manage Roles</a></li>
            {% endif %}
            </ul>
        </li>
{% endif %}

    </ul>
</nav>

<style type="text/css">
    .ODRMenuExpand li {
        margin-left: 10px;
    }
</style>

<script type="text/javascript">
    $(function() {
        $("li.ODRMenuExpand > ul").removeAttr('style');
        
        $("li.ODRMenuExpand").unbind('click').click(function() {
            $("li.ODRMenuExpand > ul").hide();
            $(this).children("ul").css(
                {
                    'display': 'block',
                    'top': '0px',
                    'left': '0px',
                    'visibility': 'visible',
                    'position': 'relative'
                }
            );
        });
    });
</script>

{% endblock %}


