{% set datafield_meta = datafield.dataFieldMeta %}
{% set field_typename = datafield_meta.fieldType.typeName %}
{% set field_typeclass = datafield_meta.fieldType.typeClass %}

{% if version == 'v1' %}
    "field_{{ datafield.id }}": {
        "field_name": {{ datafield_meta.fieldName|json_encode|raw }},    {# lack of surrounding quotation marks necessary #}
{% elseif version == 'v2' %}
    "{{ datafield_meta.xml_fieldName }}": {
{% endif %}

        "id": {{ datafield.id }},
        "description": {{ datafield_meta.description|json_encode|raw }},    {# lack of surrounding quotation marks necessary #}
        "fieldtype": "{{ field_typename }}",
        "field_uuid": "{{ datafield.fieldUuid }}",
        "template_field_uuid": "{{ datafield.templateFieldUuid }}",
        "updated_at": "{{ datafield_meta.updated|date('Y-m-d H:i:s') }}",    {# TODO - should this be controlled by using_metadata? #}

    {% if datafield_meta.renderPlugin.id != 1 %}
        "render_plugin": {{ datafield_meta.renderPlugin.pluginName|json_encode|raw }},
    {% endif %}

    {% if datafield_meta.is_unique == 1 %}
        "is_unique": 1,
    {% endif %}

    {% if using_metadata == true %}
        "_field_metadata": {
            "_create_date": "{{ datafield.created|date('Y-m-d H:i:s') }}",
            "_create_auth": "{% if datafield.createdBy != '' %}{{ datafield.createdBy|user_string|xml }}{% endif %}",
            "_public_date": "{{ datafield_meta.publicDate|date('Y-m-d H:i:s') }}",

            "_master_published_version": "{{ datafield_meta.master_published_revision }}",
            "_master_revision": "{{ datafield_meta.master_revision }}",
            "_tracking_master_version": "{{ datafield_meta.tracking_master_revision }}",
        },
    {% endif %}

    {% if field_typeclass == 'Radio' %}
        {% if datafield.radioOptions is defined %}
        "value": [
            {% for radio_option in datafield.radioOptions %}
                {% set radio_option_meta = radio_option.radioOptionMeta %}

            {# each radio option is its own JSON object...required because "value" is an array #}
            {

            {% if version == 'v1' %}
                "radio_option_{{ radio_option.id }}": {
                "name": "{{ radio_option_meta.optionName }}",
            {% elseif version == 'v2' %}
                "{{ radio_option.radioOptionMeta.optionName }}": {
            {% endif %}

                    "template_radio_option_uuid": {{ radio_option.radioOptionUuid|json_encode|raw }},
                    "updated_at": "{{ radio_option_meta.updated|date('Y-m-d H:i:s') }}"    {# TODO - should this be controlled by using_metadata? #}

                }   {# end of radio option #}

            {# each radio option is its own JSON object #}
            },

            {% endfor %}
        ]    {# end of radio options #}

        {% endif %}

    {% elseif field_typeclass == 'Tag' %}
        {% include 'ODRAdminBundle:XMLExport:datatype_tag_wrapper.json.twig' with {
            'datafield': datafield,
        } %}
    {% endif %}

},  {# end of datafield #}
