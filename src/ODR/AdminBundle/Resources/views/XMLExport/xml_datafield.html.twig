{% spaceless %}

{% set field_typename = datarecordfield.getdatafield.getfieldtype.typename %}
{% set valuefield = datarecordfield.getassociatedentity %}

{% if field_typename == "Boolean" %}

    <{{ field.getxmlfieldname }}>{% if valuefield.value == 1 %}1{% else %}0{% endif %}</{{ field.getxmlfieldname }}>

{% elseif field_typename == "File" %}

    <{{ field.getxmlfieldname }}>
    {% for file in datarecordfield.getfile %}
        <file>
            <original_name>{% if file.originalfilename != null %}{{ file.originalfilename|xml|raw }}{% else %}File_{{ file.id }}{% endif %}</original_name>
            {#<caption></caption>#}
            <source>
                <href>{{ baseurl ~ path('odr_file_download', {'file_id': file.id}) }}</href>
            </source>
            <checksum>{{ file.getoriginalchecksum }}</checksum>

            {% if using_metadata == true %}
            <_file_metadata>
                <_create_date>{{ file.created|date('Y-m-d H:i:s') }}</_create_date>
                <_create_auth>{% if file.getcreatedby != null %}{{ file.getcreatedby.getuserstring }}{% endif %}</_create_auth>
                <_public_date>{{ file.created|date('Y-m-d H:i:s') }}</_public_date>
                <_external_id>{{ file.getexternalid }}</_external_id>
            </_file_metadata>
            {% endif %}

        </file>
    {% endfor %}
    </{{ field.getxmlfieldname }}>

{% elseif field_typename == "Image" %}

    <{{ field.getxmlfieldname }}>
    {% for image in datarecordfield.getimage %}
        {% if image.getimagesize.imagetype == "thumbnail" %}
            <image>
            {% for oimage in datarecordfield.getimage %}
                {% if oimage.getimagesize.original == "1" and oimage.id == image.parent.id %}
                    <original_name>{% if image.originalfilename != null %}{{ image.originalfilename|xml|raw }}{% else %}Image_{{ oimage.id }}{% endif %}</original_name>
                    <source>
                        <href>{{ baseurl ~ path('odr_image_download', {'image_id': oimage.id}) }}</href>
                    </source>
                    <caption>{{ oimage.caption|xml|raw }}</caption>
                    <checksum>{{ oimage.getoriginalchecksum }}</checksum>

                    {% if using_metadata == true %}
                    <_image_metadata>
                        <_display_order>{{ image.displayorder }}</_display_order>
                        <_create_date>{{ oimage.created|date('Y-m-d H:i:s') }}</_create_date>
                        <_create_auth>{% if oimage.getcreatedby != null %}{{ oimage.getcreatedby.getuserstring }}{% endif %}</_create_auth>
                        <_public_date>{{ oimage.created|date('Y-m-d H:i:s') }}</_public_date>
                        <_external_id>{{ oimage.getexternalid }}</_external_id>
                    </_image_metadata>
                    {% endif %}

                {% endif %}
            {% endfor %}
            </image>
        {% endif %}
    {% endfor %}
    </{{ field.getxmlfieldname }}>

{% elseif field_typename == "Integer" or field_typename == "Decimal" or field_typename == "Short Text" or field_typename == "Medium Text" or field_typename == "Long Text" or field_typename == "Paragraph Text" %}

    <{{ field.getxmlfieldname }}>{{ valuefield.value|xml|raw }}</{{ field.getxmlfieldname }}>

{% elseif field_typename == "Single Radio" or field_typename == "Multiple Radio" or field_typename == "Single Select" or field_typename == "Multiple Select" %}

    <{{ field.getxmlfieldname }} {#type="{{ field_typename }}"#}>

    {% set option_list = radiooptionlist(field.getRadioOptions, datarecordfield.getRadioSelection) %}
    {% for radio_option in field.getRadioOptions %}
        {% set is_selected = option_list[ radio_option.id ] %}
        {% if is_selected == 1 %}
            <{{ radio_option.getxmloptionname }}>1</{{ radio_option.getxmloptionname }}>
        {% else %}
            {#<{{ radio_option.getxmloptionname }}>0</{{ radio_option.getxmloptionname }}>#}
        {% endif %}
    {% endfor %}

    </{{ field.getxmlfieldname }}>

{% elseif field_typename == "DateTime" %}

    <{{ field.getxmlfieldname }}>{% if valuefield.value|date('Y-m-d H:i:s') == '-0001-11-30' %}0000-00-00{% else %}{{ valuefield.value|date('Y-m-d H:i:s') }}{% endif %}</{{ field.getxmlfieldname }}>

{% endif %}

{% endspaceless %}
