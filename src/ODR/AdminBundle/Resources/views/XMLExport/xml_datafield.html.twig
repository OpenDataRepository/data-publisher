{% spaceless %}

{% set field_typename = datafield.dataFieldMeta.fieldType.typeName %}
{% set field_typeclass = datafield.dataFieldMeta.fieldType.typeClass %}

{% set datarecordfield = datarecord.dataRecordFields[ datafield.id ] %}

{% set valuefield = '' %}
{% if field_typename == "Boolean" %}
    {% set valuefield = datarecordfield.boolean[0] %}
{% elseif field_typename == "File" %}
    {% set valuefield = datarecordfield.file %}
{% elseif field_typename == "Image" %}
    {% set valuefield = datarecordfield.image %}
{% elseif field_typename == "Decimal" %}
    {% set valuefield = datarecordfield.decimalValue[0] %}
{% elseif field_typename == "Integer" %}
    {% set valuefield = datarecordfield.integerValue[0] %}
{% elseif field_typename == "Paragraph Text" %}
    {% set valuefield = datarecordfield.longText[0] %}
{% elseif field_typename == "Long Text" %}
    {% set valuefield = datarecordfield.longVarchar[0] %}
{% elseif field_typename == "Medium Text" %}
    {% set valuefield = datarecordfield.mediumVarchar[0] %}
{% elseif field_typename == "Single Radio" %}
    {% set valuefield = datarecordfield.radioSelection %}
{% elseif field_typename == "Short Text" %}
    {% set valuefield = datarecordfield.shortVarchar[0] %}
{% elseif field_typename == "DateTime" %}
    {% set valuefield = datarecordfield.datetimeValue[0] %}
{% elseif field_typename == "Markdown" %}
    {% set valuefield = '' %}
{% endif %}


{% if field_typename == "Boolean" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}>{% if valuefield.value == 1 %}1{% else %}0{% endif %}</{{ datafield.dataFieldMeta.xml_fieldName }}>

{% elseif field_typename == "File" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}>
    {% for file in valuefield %}
        <file>
            <original_name>{% if file.fileMeta.originalFileName != null %}{{ file.fileMeta.originalFileName|xml|raw }}{% else %}File_{{ file.id }}{% endif %}</original_name>
            <href>{{ baseurl ~ path('odr_file_download', {'file_id': file.id}) }}</href>
            {#<caption></caption>#}
            {#<checksum>{{ file.getoriginalchecksum }}</checksum>#}

            {% if using_metadata == true %}
            <_file_metadata>
                <_create_date>{{ file.created|date('Y-m-d H:i:s') }}</_create_date>
                <_create_auth>{% if file.createdBy != '' %}{{ file.createdBy|user_string }}{% endif %}</_create_auth>
                <_public_date>{{ file.created|date('Y-m-d H:i:s') }}</_public_date>
                <_external_id>{{ file.fileMeta.external_id }}</_external_id>
            </_file_metadata>
            {% endif %}

        </file>
    {% endfor %}
    </{{ datafield.dataFieldMeta.xml_fieldName }}>

{% elseif field_typename == "Image" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}>
    {% for image in valuefield %}
        {% set oimage = image.parent %}
        {% set image_ext = oimage.ext %}
        {% set image_caption = oimage.imageMeta.caption %}
        {% set image_filename = oimage.imageMeta.originalFileName %}

        <image>
            <original_name>{% if image_filename != '' %}{{ image_filename|xml|raw }}{% else %}Image_{{ oimage.id }}{% endif %}</original_name>
            <href>{{ baseurl ~ path('odr_image_download', {'image_id': oimage.id}) }}</href>
            <caption>{{ image_caption|xml|raw }}</caption>
            {#<checksum>{{ oimage.getoriginalchecksum }}</checksum>#}

            {% if using_metadata == true %}
            <_image_metadata>
                <_display_order>{{ oimage.imageMeta.displayorder}}</_display_order>
                <_create_date>{{ oimage.created|date('Y-m-d H:i:s') }}</_create_date>
                <_create_auth>{% if oimage.createdBy != '' %}{{ oimage.createdBy|user_string }}{% endif %}</_create_auth>
                <_public_date>{{ oimage.created|date('Y-m-d H:i:s') }}</_public_date>
                <_external_id>{{ oimage.imageMeta.external_id }}</_external_id>
            </_image_metadata>
            {% endif %}

        </image>
    {% endfor %}
    </{{ datafield.dataFieldMeta.xml_fieldName }}>

{% elseif field_typename == "Integer" or field_typename == "Decimal" or field_typename == "Short Text" or field_typename == "Medium Text" or field_typename == "Long Text" or field_typename == "Paragraph Text" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}>{{ valuefield.value|xml|raw }}</{{ datafield.dataFieldMeta.xml_fieldName }}>

{% elseif field_typename == "Single Radio" or field_typename == "Multiple Radio" or field_typename == "Single Select" or field_typename == "Multiple Select" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}{#type="{{ field_typename }}"#}>

    {% for radio_option in datafield.radioOptions %}
        {% set is_selected = 0 %}
        {% if datarecordfield.radioSelection[ radio_option.id ] is defined %}
            {% set is_selected = datarecordfield.radioSelection[ radio_option.id ].selected %}
        {% endif %}

        {% if is_selected == 1 %}
            <{{ radio_option.radioOptionMeta.xml_optionName }}>1</{{ radio_option.radioOptionMeta.xml_optionName }}>
        {% else %}
            {#<{{ radio_option.radioOptionMeta.xml_optionName }}>0</{{ radio_option.radioOptionMeta.xml_optionName }}>#}
        {% endif %}
    {% endfor %}

    </{{ datafield.dataFieldMeta.xml_fieldName }}>

{% elseif field_typename == "DateTime" %}

    <{{ datafield.dataFieldMeta.xml_fieldName }}>{% if valuefield.value|date('Y-m-d') == '-0001-11-30' %}0000-00-00{% else %}{{ valuefield.value|date('Y-m-d') }}{% endif %}</{{ datafield.dataFieldMeta.xml_fieldName }}>

{% endif %}

{% endspaceless %}
