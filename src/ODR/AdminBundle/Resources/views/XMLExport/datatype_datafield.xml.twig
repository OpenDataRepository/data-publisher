{% spaceless %}

{% set datafield_meta = datafield.dataFieldMeta %}
{% set field_typename = datafield_meta.fieldType.typeName %}
{% set field_typeclass = datafield_meta.fieldType.typeClass %}

{% set tag_start = '' %}
{% set tag_end = '' %}
{% if version == 'v1' %}
    {% set tag_start = '<datafield_' ~ datafield.id ~ ' datafield_name="' ~ datafield_meta.fieldName|xml ~'">' %}
    {% set tag_end = '</datafield_' ~ datafield.id ~ '>' %}
{% elseif version == 'v2' %}
    {% set tag_start = '<' ~ datafield_meta.xml_fieldName ~ '>' %}
    {% set tag_end = '</' ~ datafield_meta.xml_fieldName ~ '>' %}
{% endif %}


{{ tag_start|raw }}

    <internal_id>{{ datafield.id }}</internal_id>
    <name>{{ datafield_meta.fieldName|xml }}</name>
    <description>{{ datafield_meta.description|xml }}</description>
    <fieldtype>{{ field_typename }}</fieldtype>

    {% if datafield_meta.renderPlugin.id != 1 %}
    <render_plugin>
        <name>{{ datafield_meta.renderPlugin.pluginName }}</name>
    </render_plugin>
    {% endif %}

    {% if datafield_meta.is_unique == 1 %}
    <is_unique/>
    {% endif %}

    {% if using_metadata == true %}
    <_datafield_metadata>
        <_create_date>{{ datafield.created|date('Y-m-d H:i:s') }}</_create_date>
        <_create_auth>{% if datafield.createdBy != '' %}{{ datafield.createdBy|user_string|xml }}{% endif %}</_create_auth>
        <_public_date>{{ datafield_meta.publicDate|date('Y-m-d H:i:s') }}</_public_date>
    
        <_master_published_version>{{ datafield_meta.master_published_revision }}</_master_published_version>
        <_master_revision>{{ datafield_meta.master_revision }}</_master_revision>
        <_tracking_master_version>{{ datafield_meta.tracking_master_revision }}</_tracking_master_version>
    </_datafield_metadata>
    {% endif %}

    {% if field_typeclass == 'Radio' %}
    <radio_options>
        {% if datafield.radioOptions is defined %}
        {% for radio_option in datafield.radioOptions %}
            
            {% set radio_option_meta = radio_option.radioOptionMeta %}

            {% set radio_tag_start = '' %}
            {% set radio_tag_end = '' %}
            {% if version == 'v1' %}
                {% set radio_tag_start = '<radio_option_' ~ radio_option.id ~ ' radio_option_name="' ~ radio_option_meta.optionName|xml ~'">' %}
                {% set radio_tag_end = '</radio_option_' ~ radio_option.id ~ '>' %}
            {% elseif version == 'v2' %}
                {% set radio_tag_start = '<' ~ radio_option_meta.xml_fieldName ~ '>' %}
                {% set radio_tag_end = '</' ~ radio_option_meta.xml_fieldName ~ '>' %}
            {% endif %}

            {{ radio_tag_start|raw }}
                <name>{{ radio_option_meta.optionName|xml }}</name>
            {{ radio_tag_end|raw }}

        {% endfor %}
    {% endif %}
    </radio_options>
    {% endif %}
{{ tag_end|raw }}

{% endspaceless %}
