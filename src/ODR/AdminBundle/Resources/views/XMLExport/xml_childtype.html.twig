{% macro input(datatype_tree, datarecord_tree, using_metadata, baseurl) %}

{% spaceless %}

{% set datatype = datatype_tree.datatype %}

{% if datatype_tree.top_level == false %}
    <datarecords>
{% endif %}

{% for dr_entry in datarecord_tree %}
    {% set datarecord = dr_entry.datarecord %}

    {% if datatype_tree.is_link == 0 %}
        {# display metadata and datafields for top-level and child datarecords #}
        {% if datatype_tree.top_level == false %}
        <datarecord>
        {% endif %}

        {% if using_metadata == true %}
            <_datarecord_metadata>
                <_external_id>{{ datarecord.getexternalid }}</_external_id>
                <_create_date>{{ datarecord.created|date('Y-m-d H:i:s') }}</_create_date>
                <_create_auth>{% if datarecord.getcreatedby != null %}{{ datarecord.getcreatedby.getuserstring }}{% endif %}</_create_auth>
                <_public_date>{{ datarecord.getpublicdate|date('Y-m-d H:i:s') }}</_public_date>
            </_datarecord_metadata>
        {% endif %}

        {% include 'ODRAdminBundle:XMLExport:xml_fields.html.twig' with {'datatype_tree': datatype_tree, 'dr_entry': dr_entry, 'using_metadata': using_metadata, 'baseurl': baseurl} %}

        {% if datatype_tree.top_level == false %}
        </datarecord>
        {% endif %}

    {% else %}
        {# only display external id for linked datarecords #}
        <datarecord><_external_id>{{ datarecord.getexternalid }}</_external_id></datarecord>
    {% endif %}

{% endfor %}

{% if datatype_tree.top_level == false %}
    </datarecords>
{% endif %}

{% endspaceless %}

{% endmacro %}
