{% spaceless %}

{% set ANY_CONTEXT = constant('ODR\\AdminBundle\\Entity\\ThemeMeta::ANY_CONTEXT') %}
{% set SHORT_CONTEXT = constant('ODR\\AdminBundle\\Entity\\ThemeMeta::SHORT_CONTEXT') %}
{% set LONG_CONTEXT = constant('ODR\\AdminBundle\\Entity\\ThemeMeta::LONG_CONTEXT') %}

{% set hide_theme = false %}
{% if theme_data.theme_visibility == LONG_CONTEXT and (page_type == 'search_results' or page_type == 'linking') %}
    {% set hide_theme = true %}
{% elseif theme_data.theme_visibility == SHORT_CONTEXT and (page_type == 'display' or page_type == 'edit') %}
    {% set hide_theme = true %}
{% endif %}

<li data-theme-id="{{ theme_data.id }}" {% if theme_data.id == selected_theme_id %}class="ODRCurrentLayout"{% elseif hide_theme %}class="ODRHiddenLayout ODRHidden"{% endif %}>
    <div class="pure-u-1 pure-u-md-6-24">
        <h4>
        {% if theme_data.name != "" %}
            {{ theme_data.name }}
        {% else %}
            Unnamed View.
        {% endif %}
        </h4>
        <div class="ODRChooseViewDescription">
        {% if theme_data.description != "" %}
            {{ theme_data.description }}
        {% else %}
            No description.
        {% endif %}
        </div>
        <div>Created By: {{ theme_data.created_by_name }}</div>
{#        <div>theme id: {{ theme_data.id }}&nbsp;&nbsp;theme type: {{ theme_data.theme_type }}&nbsp;&nbsp;page type: {{ formatted_page_type }}</div>#}
    </div>

    <div class="pure-u-1 pure-u-md-11-24 ODRChooseViewDetails">
    {% set need_spacer = false %}

    {% if theme_data.id == selected_theme_id %}
        <div class="ODRViewNote">[ Currently selected view. ]</div>
        {% set need_spacer = true %}
    {% endif %}

    {% if theme_data.theme_type == "master" or theme_data.is_table_theme %}
        <div class="ODRViewNote">{% if theme_data.theme_type == "master" %}[ Master theme/view for database ]&nbsp;&nbsp;{% endif %}{% if theme_data.is_table_theme %}[ Table view ]{% endif %}</div>
        {% set need_spacer = true %}
    {% endif %}
    {% if theme_data.theme_visibility == SHORT_CONTEXT %}
        <div class="ODRViewNote">[ Intended for searching/linking ]</div>
        {% set need_spacer = true %}
    {% elseif theme_data.theme_visibility == LONG_CONTEXT %}
        <div class="ODRViewNote">[ Intended for display/edit ]</div>
        {% set need_spacer = true %}
    {% endif %}

    {% if need_spacer %}
        <div class="ODRViewNote">&nbsp;</div>
        {% set need_spacer = false %}
    {% endif %}

    {% if theme_data.default_for|length > 0 %}
        {% set need_spacer = true %}
        {% for num,label in theme_data.default_for %}
        {% set need_spacer = true %}
        <div class="ODRViewNote">
            {% if is_datatype_admin %}<i class="ODRUnsetDefaultDatabase fa fa-unlink" title="Stop using as database default" rel="{{ label }}"></i>&nbsp;{% endif %}
            [ <i class="fa fa-database CursorOverride"></i>&nbsp;Database default for {{ label }} mode. ]
        </div>
        {% endfor %}
    {% endif %}

    {% if user != "anon." %}
        {% for num,label in theme_data.user_preference_for %}
        {% set need_spacer = true %}
        <div class="ODRViewNote">
            <i class="ODRUnsetDefaultPersonal fa fa-unlink" title="Stop using as personal default" rel="{{ label }}"></i>&nbsp;
            [ <i class="fa fa-user CursorOverride"></i>&nbsp;Personal default for {{ label }} mode. ]
        </div>
        {% endfor %}
    {% endif %}

    {% if need_spacer %}
        <div class="ODRViewNote">&nbsp;</div>
        {% set need_spacer = false %}
    {% endif %}

    {% if is_datatype_admin and formatted_page_type not in theme_data.default_for and theme_data.is_shared %}
        <div class="ODRViewNote">
            <i class="ODRDefaultDatabase fa fa-link"></i>&nbsp;
            Use as database default for {% if formatted_page_type != '' %}{{ formatted_page_type }}{% else %}current{% endif %} mode.
        </div>
    {% endif %}

    {% if user != "anon." and formatted_page_type not in theme_data.user_preference_for %}
        <div class="ODRViewNote">
            <i class="ODRDefaultPersonal fa fa-link"></i>&nbsp;
            Use as your personal default for {% if formatted_page_type != '' %}{{ formatted_page_type }}{% else %}current{% endif %} mode.
        </div>
    {% endif %}
    </div>

    <div class="pure-u-1 pure-u-md-6-24">
        <ul class="ODRViewOptions">
        {% set need_spacer = false %}

        {% if theme_data.id != selected_theme_id %}
            {# this dialog only receives themes the user is allowed to use #}
            <li class="ODRChooseViewLink ODRMakeCurrentView">
                <i class="fa fa-eye"></i>&nbsp;Use (current session)
            </li>

            <li>&nbsp;</li>
        {% endif %}

        {% if is_datatype_admin or (user != "anon." and theme_data.created_by == user.id and theme_data.theme_type != "master") %}
            {# datatype admins are allowed to edit any theme for this datatype #}
            {# non-datatype admins can only edit non-master themes they created #}
            <li class="ODRChooseViewLink ODRModifyTheme">
                <i class="fa fa-edit"></i>&nbsp;Edit
            </li>
        {% endif %}

        {% if user != "anon." %}
            {# users are allowed to make their own copy of any theme they can use #}
            <li class="ODRChooseViewLink ODRCopyModifyTheme">
                <i class="fa fa-copy"></i>&nbsp;Copy
            </li>
        {% endif %}

        {% if theme_data.theme_type != "master" %}
            {# never allowed to delete a master theme... #}
            {% if is_super_admin or (user != "anon." and theme.created_by == user.id) %}
                {# ...but super admins can delete any other theme, while regular users can only delete themes they created #}
                {# datatype admins are not allowed to delete themes belonging to other users #}
                {% if theme_data.default_for|length > 0 %}
                    {# if it's a default for some mode, then show the link but don't activate it #}
                    <li class="ODRChooseViewLink strikethrough" title="This layout can't be deleted because it is being used as a database default">
                        <i class="fa fa-trash"></i>&nbsp;Delete
                    </li>
                {% else %}
                    <li class="ODRChooseViewLink ODRDeleteTheme">
                        <i class="fa fa-trash"></i>&nbsp;Delete
                    </li>
                {% endif %}
            {% endif %}
        {% endif %}


        {% if user != "anon." %}
            {# have to be logged in to change public status of theme... #}
            {% if theme_data.default_for|length > 0 or theme_data.theme_type == "master" %}
                {# never allowed to change public status of default themes #}
                <li class="ODRChooseViewLink strikethrough" title="This layout can't be set to private because it is being used as a database default">
                    <i class="fa fa-globe ODRPublic"></i>&nbsp;Make private
                </li>
            {% elseif is_super_admin or theme_data.created_by == user.id %}
                {# super-admins can change public status of any other theme in the datatype #}
                {# datatype admins and regular users are only allowed to change public status of themes they created #}
                {% if theme_data.is_shared %}
                <li class="ODRChooseViewLink ODRMakeViewShared">
                    <i class="fa fa-globe ODRPublic"></i>&nbsp;Make private
                </li>
                {% else %}
                <li class="ODRChooseViewLink ODRMakeViewShared">
                    <i class="fa fa-globe ODRNotPublic"></i>&nbsp;Make public
                </li>
                {% endif %}
            {% endif %}
        {% endif %}
        </ul>
    </div>
</li>

{% endspaceless %}
