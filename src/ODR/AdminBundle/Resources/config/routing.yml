#-----------------------------------------
# Basic routes
odr_admin_homepage:
    path:  /admin
    defaults: { _controller: ODRAdminBundle:Default:index }

odr_logout:
    path:  /logout



#-----------------------------------------

#-----------------------------------------
# ODRUser Controller
# public routes to let users modify their own profile
odr_self_profile_edit:
    path:  /profile_edit
    defaults: { _controller: ODRAdminBundle:ODRUser:selfeditprofile }

odr_self_profile_save:
    path:  /profile_save
    defaults: { _controller: ODRAdminBundle:ODRUser:selfsaveprofile }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# ODRUser Controller
odr_admin_new_user_create:
    path:  /admin/new_user/create
    defaults: { _controller: ODRAdminBundle:ODRUser:createnewuser }

odr_admin_new_user_check:
    path:  /admin/new_user/check_email
    defaults: { _controller: ODRAdminBundle:ODRUser:checkemailexistence }
    methods: [ POST ]

odr_admin_new_user_save:
    path: /admin/new_user/save
    defaults: { _controller: ODRAdminBundle:ODRUser:savenewuser }
    methods: [ POST ]

odr_admin_change_password:
    path:  /admin/user/change_password/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:changepassword }
    requirements:
        user_id:  \d+

odr_admin_save_password:
    path:  /admin/user/change_password/save
    defaults: { _controller: ODRAdminBundle:ODRUser:savepassword }
    methods: [ POST ]

odr_profile_edit:
    path:  /admin/user/profile_edit/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:editprofile }
    requirements:
        user_id:  \d+

odr_profile_save:
    path:  /admin/user/save
    defaults: { _controller: ODRAdminBundle:ODRUser:saveprofile }
    methods: [ POST ]

odr_user_list:
    path:  /admin/user/list
    defaults: { _controller: ODRAdminBundle:ODRUser:listusers }

odr_manage_user_roles:
    path:  /admin/user/manage/roles
    defaults: { _controller: ODRAdminBundle:ODRUser:manageroles }

odr_set_user_role:
    path:  /admin/user/setrole/{user_id}/{role}
    defaults: { _controller: ODRAdminBundle:ODRUser:setrole }
    requirements:
        user_id:  \d+
        role:  '|user|admin|sadmin|jupyterhub'

odr_delete_user:
    path:  /admin/user/delete/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:deleteuser }
    requirements:
        user_id:  \d+

odr_undelete_user:
    path:  /admin/user/undelete/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:undeleteuser }
    requirements:
        user_id:  \d+

odr_view_effective_permissions:
    path:  /admin/user/view_as/{user_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:vieweffectivepermissions }
    requirements:
        user_id:  \d+
        datatype_id:  \d+

odr_view_permissions_result:
    path:  /admin/user/view_theme/{user_id}/{theme_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:viewpermissionsresult }
    requirements:
        user_id:  \d+
        theme_id:  \d+

#-----------------------------------------

#-----------------------------------------
# ODRGroup Controller
odr_manage_groups:
    path:  /admin/group/manange/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:managegroups }
    requirements:
        datatype_id:  \d+

odr_load_group_list:
    path:  /admin/group/list/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:grouplist }
    requirements:
        datatype_id:  \d+

odr_add_group:
    path:  /admin/group/add/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:addgroup }
    requirements:
        datatype_id:  \d+

odr_delete_group:
    path:  /admin/group/delete/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:deletegroup }
    requirements:
        group_id:  \d+

odr_group_properties:
    path:  /admin/group/load/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:groupproperties }
    requirements:
        group_id:  \d+

odr_datatype_group_membership:
    path:  /admin/group/members_datatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:datatypegroupmembers }
    requirements:
        datatype_id:  \d+


odr_manage_user_groups:
    path:  /admin/user/managegroups/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:manageusergroups }
    requirements:
        user_id:  \d+

odr_change_user_group:
    path:  /admin/user/changegroup/{user_id}/{group_id}/{value}
    defaults: { _controller: ODRAdminBundle:ODRGroup:changeusergroup }
    requirements:
        user_id:  \d+
        group_id:  \d+
        value:  0|1


odr_manage_group_permissions:
    path:  /admin/group/permissions/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:grouppermissions }
    requirements:
        group_id:  \d+


odr_save_group_datatype_permission:
    path:  /admin/group/savepermissions/datatype/{group_id}/{datatype_id}/{value}/{permission}
    defaults: { _controller: ODRAdminBundle:ODRGroup:savedatatypepermission }
    requirements:
        group_id:  \d+
        datatype_id:  \d+
        value: '0|1'
        permission:  'dt_view|dr_view|dr_add|dr_delete|dr_public|dt_admin|'

odr_save_group_datafield_permission:
    path:  /admin/group/savepermissions/datafield/{group_id}/{datafield_id}/{value}
    defaults: { _controller: ODRAdminBundle:ODRGroup:savedatafieldpermission }
    requirements:
        group_id:  \d+
        datafield_id:  \d+
        value: '0|1|2'
#-----------------------------------------

#-----------------------------------------
# Plugin Controller
odr_render_plugin_list:
    path:  /admin/plugins/list
    defaults: { _controller: ODRAdminBundle:Plugins:pluginlist }

odr_install_plugin:
    path:  /admin/plugins/install
    defaults: { _controller: ODRAdminBundle:Plugins:installplugin }
    methods: [ POST ]

odr_plugin_problems:
    path:  /admin/plugins/problems/{plugin_classname}
    defaults: { _controller: ODRAdminBundle:Plugins:pluginproblems }
    requirements:
        plugin_classname: '^[a-z0-9\.\_\-]*$'
odr_plugin_uses:
    path:  /admin/plugins/uses/{plugin_classname}
    defaults: { _controller: ODRAdminBundle:Plugins:pluginuses }
    requirements:
        plugin_classname: '^[a-z0-9\.\_\-]*$'

odr_update_plugin:
    path:  /admin/plugins/update
    defaults: { _controller: ODRAdminBundle:Plugins:updateplugin }
    methods: [ POST ]


odr_render_plugin_dialog:
    path:  /design/displaytemplate/plugindialog/{datatype_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Plugins:renderplugindialog }
    requirements:
        datatype_id:  \d+
        datafield_id:  \d+

odr_load_plugin_data:
    path:  /design/displaytemplate/plugindata/{datatype_id}/{datafield_id}/{render_plugin_id}
    defaults: { _controller: ODRAdminBundle:Plugins:renderpluginsettings }
    requirements:
        datatype_id:  \d+
        datafield_id:  \d+
        render_plugin_id:  \d+

odr_detach_plugin:
    path:  /design/displaytemplate/detachplugin/{datatype_id}/{datafield_id}/{render_plugin_id}
    defaults: { _controller: ODRAdminBundle:Plugins:detachrenderplugin }
    requirements:
        datatype_id:  \d+
        datafield_id:  \d+
        render_plugin_id:  \d+

odr_save_render_plugin_settings:
    path:  /design/displaytemplate/saverenderpluginsettings
    defaults: { _controller: ODRAdminBundle:Plugins:saverenderpluginsettings }
    methods: [ POST ]


odr_render_plugin_layout_settings_dialog:
    path: /design/displaytemplate/pluginlayoutsettingsdialog/{theme_id}/{datatype_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Plugins:pluginlayoutsettingsdialog }
    requirements:
        theme_id: \d+
        datatype_id: \d+
        datafield_id: \d+

odr_load_plugin_layout_settings_data:
    path:  /design/displaytemplate/pluginlayoutsettingsdata/{theme_id}/{datatype_id}/{datafield_id}/{render_plugin_id}
    defaults: { _controller: ODRAdminBundle:Plugins:renderpluginlayoutsettings }
    requirements:
        theme_id: \d+
        datatype_id:  \d+
        datafield_id:  \d+
        render_plugin_id:  \d+

odr_save_render_plugin_layout_settings:
    path:  /design/displaytemplate/saverenderpluginlayoutsettings
    defaults: { _controller: ODRAdminBundle:Plugins:saverenderpluginlayoutsettings }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# DataType Controller
odr_list_types:
    path:  /admin/type/list/{section}
    defaults: { _controller: ODRAdminBundle:Datatype:list }
    requirements:
        section: databases|templates|datatemplates

odr_datatype_properties:
    path:  /admin/type/properties/{datatype_id}/{wizard}
    defaults: { _controller: ODRAdminBundle:Datatype:properties }
    requirements:
        datatype_id: \d+
        wizard: 0|1

odr_datatype_properties_meta:
    path:  /admin/type/properties/update/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Datatype:update_properties }
    requirements:
        datatype_id: \d+

odr_datatype_landing:
    path:  /admin/type/landing/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Datatype:landing }
    requirements:
        datatype_id: \d+

odr_create_type:
    path:  /admin/type/create/{create_master}
    defaults: { _controller: ODRAdminBundle:Datatype:create }
    requirements:
        create_master: 0|1|2

odr_create_type_info:
    path:  /admin/type/create/info/{template_choice}/{creating_master_template}
    defaults: { _controller: ODRAdminBundle:Datatype:createinfo }
    requirements:
        template_choice: \d+
        creating_master_template: 0|1|2

odr_add_metadata_type_chooser:
    path:  /admin/type/addmeta/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Datatype:choosemeta }
    requirements:
        datatype_id: \d+

odr_add_metadata_to_datatype:
    path:  /admin/type/addmetadata/{template_choice}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Datatype:addmetadata }
    requirements:
        template_choice: \d+
        datatype_id: \d+

odr_add_types:
    path:  /admin/type/add
    defaults: { _controller: ODRAdminBundle:Datatype:add }
    methods: [ POST ]

odr_add_blank_metadata_datatype:
    path:  /admin/type/addblankmetadata/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Datatype:createblankmeta }
    requirements:
        datatype_id: \d+

odr_list_copy_databases:
    path:  /admin/type/copy/list
    defaults: { _controller: ODRAdminBundle:Datatype:listcopydatabases }

odr_copy_normal_database:
    path:  /admin/type/copy/start
    defaults: { _controller: ODRAdminBundle:Datatype:copynormaldatabase }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Theme Controller
odr_get_available_themes:
    path:  /view/getthemes/{datatype_id}/{page_type}/{search_key}
    defaults: { _controller: ODRAdminBundle:Theme:getavailablethemes, search_key: '' }
    requirements:
        datatype_id:  \d+
        page_type:  '|search_results|display|edit|linking'
        search_key: '[a-zA-Z0-9\-\_]*'

odr_save_theme_properties:
    path:  /view/theme_properties/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:savethemeproperties }
    requirements:
        theme_id: \d+

odr_design_theme_element_visibility:
    path:  /design/themeelementvisibility/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeelementvisibility }
    requirements:
        theme_element_id:  \d+

odr_design_theme_element_border_visibility:
    path:  /design/themeelementbordervisibility/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeelementbordervisibility }
    requirements:
        theme_element_id:  \d+

odr_design_theme_datafield_visibility:
    path:  /design/themedatafieldvisibility/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:themedatafieldvisibility }
    requirements:
        theme_element_id:  \d+
        datafield_id: \d+
odr_design_theme_datafield_header_visibility:
    path:  /design/themedatafieldheadervisibility/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:themedatafieldheadervisibility }
    requirements:
        theme_element_id:  \d+
        datafield_id: \d+
odr_design_theme_datafield_use_icon:
    path:  /design/themedatafielduseicon/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:themedatafielduseicon }
    requirements:
        theme_element_id:  \d+
        datafield_id: \d+

odr_toggle_theme_shared:
    path:  /design/toggleshared/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeshared }
    requirements:
        theme_id:  \d+

odr_make_default_theme:
    path:  /design/makedefault/{page_type}/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:setdatabasedefaulttheme }
    requirements:
        page_type:  '|search_results|display|edit|linking'
        theme_id:  \d+

odr_unset_default_theme:
    path:  /design/unsetdefault/{page_type}/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:unsetdatabasedefaulttheme }
    requirements:
        page_type:  '|search_results|display|edit|linking'
        theme_id:  \d+
odr_unset_personal_theme:
    path:  /design/unsetpersonal/{page_type}/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:unsetpersonaldefaulttheme }
    requirements:
        page_type:  '|search_results|display|edit|linking'
        theme_id:  \d+

odr_delete_custom_theme:
    path:  /design/delete_view/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:deletetheme }
    requirements:
        theme_id:  \d+

odr_modify_theme:
    path:  /design/modify_view/{datatype_id}/{theme_id}/{search_key}
    defaults: { _controller: ODRAdminBundle:Theme:modifytheme, search_key: '' }
    requirements:
        datatype_id:  \d+
        theme_id:  \d+
        search_key: '[a-zA-Z0-9\-\_]*'

odr_clone_theme:
    path:  /design/copy_view/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:clonetheme }
    requirements:
        theme_id:  \d+

odr_theme_reload_theme_element:
    path: /design/theme/themeelementreload/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:reloadthemeelement }
    requirements:
        theme_element_id: \d+

odr_design_add_theme_element:
    path:  /design/themeelement/add/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:addthemeelement }
    requirements:
        theme_id:  \d+

odr_design_delete_theme_element:
    path:  /design/themeelement/delete/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:deletethemeelement }
    requirements:
        theme_element_id:  \d+

odr_design_get_theme_element_properties:
    path:  /design/themeelement/properties/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeelementproperties }
    requirements:
        theme_element_id:  \d+

odr_design_save_theme_element_order:
    path:  /design/themeelement/order
    defaults: { _controller: ODRAdminBundle:Theme:themeelementorder }
    methods: [ POST ]

odr_design_save_datafield_order:
    path:  /design/theme/datafieldorder/{initial_theme_element_id}/{ending_theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:datafieldorder }
    methods: [ POST ]
    requirements:
        initial_theme_element_id: \d+
        ending_theme_element_id: \d+

odr_design_load_theme_datafield:
    path:  /design/theme/loadthemedatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadthemedatafield }
    requirements:
        datafield_id: \d+
        theme_element_id: \d+

# Save routes should not need parameters
odr_design_save_theme_datafield:
    path:  /design/theme/savethemedatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:savethemedatafield }
    methods: [ POST ]
    requirements:
        theme_element_id: \d+
        datafield_id: \d+

odr_design_load_theme_datatype:
    path:  /design/theme/loadthemedatatype/{theme_element_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadthemedatatype }
    requirements:
        theme_element_id: \d+
        datatype_id: \d+

# Save routes should not need parameters
odr_design_save_theme_datatype:
    path:  /design/theme/savethemedatatype/{theme_element_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Theme:savethemedatatype }
    methods: [ POST ]
    requirements:
        theme_element_id: \d+
        datatype_id: \d+

#-----------------------------------------

#-----------------------------------------
# Displaytemplate Controller
odr_create_status_check:
    path:  /design/status/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:check_status }
    requirements:
        datatype_id:  \d+

odr_design_master_theme:
    path:  /design/displaytemplate/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:design }
    requirements:
        datatype_id:  \d+

odr_design_metadata_theme:
    path:  /design/metadatatemplate/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:design }
    requirements:
        datatype_id:  \d+


odr_design_reload_theme_element:
    path: /design/displaytemplate/themeelementreload/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:reloadthemeelement }
    requirements:
        theme_element_id: \d+

odr_design_reload_datafield:
    path: /design/displaytemplate/datafieldreload/{source_datatype_id}/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:reloaddatafield }
    requirements:
        source_datatype_id: \d+
        theme_element_id: \d+
        datafield_id: \d+


odr_design_get_datatype_properties:
    path:  /design/displaytemplate/datatypeproperties/{datatype_id}/{parent_datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datatypeproperties, parent_datatype_id: '', theme_element_id: '' }
    requirements:
        datatype_id:  \d+
        parent_datatype_id: \d+
        theme_element_id: \d+

odr_design_save_datatree:
    path:  /design/displaytemplate/savedatatree/{datatree_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savedatatree }
    methods: [ POST ]
    requirements:
        datatree_id: \d+

odr_design_get_datafield_properties:
    path:  /design/displaytemplate/datafieldproperties/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datafieldproperties }
    requirements:
        datafield_id:  \d+

odr_design_get_multi_datafield_properties:
    path:  /design/displaytemplate/datafieldproperties/get/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getmultiplefieldproperties }
    requirements:
        datatype_id:  \d+

odr_design_save_multi_datafield_properties:
    path:  /design/displaytemplate/datafieldproperties/save/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savemultiplefieldproperties }
    requirements:
        datatype_id:  \d+

odr_design_get_special_datafield_properties:
    path:  /design/displaytemplate/special_datafields/get/{datatype_id}/{type}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getspecialdatafields }
    requirements:
        datatype_id:  \d+
        type: '|name|sort'

odr_design_save_special_datafield_properties:
    path:  /design/displaytemplate/special_datafields/save/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savespecialdatafields }
    requirements:
        datatype_id:  \d+

odr_design_get_stored_search_keys:
    path:  /design/displaytemplate/search_keys/get/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getstoredsearchkeys }
    requirements:
        datatype_id:  \d+

odr_design_convert_to_stored_search_key:
    path:  /design/displaytemplate/search_keys/create
    defaults: { _controller: ODRAdminBundle:Displaytemplate:converttostoredsearchkey }
    methods: [ POST ]

odr_design_save_stored_search_keys:
    path:  /design/displaytemplate/search_keys/save/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savestoredsearchkeys }
    requirements:
        datatype_id:  \d+

odr_design_delete_datafield:
    path:  /design/displaytemplate/deletefield/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:deletedatafield }
    requirements:
        datafield_id:  \d+

odr_design_get_deleted_datafields:
    path:  /design/deleted/datafields/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getdeleteddatafields }
    requirements:
        datatype_id:  \d+

odr_design_undelete_datafield:
    path:  /design/undelete/datafield
    defaults: { _controller: ODRAdminBundle:Displaytemplate:undeletedatafield }
    methods: [ POST ]

odr_design_delete_datatype:
    path:  /design/displaytemplate/deletedatatype/{datatype_id}
    # deals with both top-level and child datatypes
    defaults: { _controller: ODRAdminBundle:Displaytemplate:deletedatatype }
    requirements:
        datatype_id:  \d+

odr_design_add_childtype:
    path:  /design/displaytemplate/addchilddatatype/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:addchilddatatype }
    requirements:
        theme_element_id:  \d+

odr_design_add_datafield:
    path:  /design/displaytemplate/adddatafield/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:adddatafield }
    requirements:
        theme_element_id:  \d+

odr_design_copy_datafield:
    path:  /design/displaytemplate/copydatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:copydatafield }
    requirements:
        theme_element_id:  \d+
        datafield_id:  \d+

odr_design_public_datatype:
    path:  /design/displaytemplate/publicdatatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datatypepublic }
    requirements:
        datatype_id:  \d+

odr_design_public_datafield:
    path:  /design/displaytemplate/publicdatafield/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datafieldpublic }
    requirements:
        datafield_id:  \d+

odr_markdown_help_dialog:
    path:  /design/displaytemplate/markdownhelp
    defaults: { _controller: ODRAdminBundle:Displaytemplate:markdownhelp }

odr_save_search_notes:
    path:  /design/displaytemplate/save_notes/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savesearchnotes }
    methods: [POST]
    requirements:
        datatype_id: \d+

odr_design_sync_with_template:
    path: /design/displaytemplate/templatesync/{datatype_id}/{sync_metadata}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:syncwithtemplate }
    requirements:
        datatype_id: \d+
        sync_metadata: 0|1
odr_design_check_sync_with_template:
    path: /design/displaytemplate/checktemplatesync/{datatype_id}/{sync_metadata}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:checksyncwithtemplate }
    requirements:
        datatype_id: \d+
        sync_metadata: 0|1

#-----------------------------------------

#-----------------------------------------
# Edit Controller
odr_record_edit:
    path:  /edit/{datarecord_id}/{search_theme_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Edit:edit, search_theme_id: 0, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_theme_id: \d+
        search_key: '[a-zA-Z0-9\-\_]*'
        offset: \d+

odr_record_reload_child:
    path: /edit/childreload/{theme_element_id}/{parent_datarecord_id}/{top_level_datarecord_id}/{edit_behavior_override}
    defaults: { _controller: ODRAdminBundle:Edit:reloadchild, edit_behavior_override: 0 }
    requirements:
        theme_element_id: \d+
        parent_datarecord_id: \d+
        top_level_datarecord_id: \d+
        edit_behavior_override: \d+
odr_record_reload_datafield:
    path: /edit/datafieldreload/{source_datarecord_id}/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:reloaddatafield }
    requirements:
        source_datarecord_id: \d+
        datarecord_id: \d+
        datafield_id: \d+
odr_record_reload_file_datafield:
    path: /edit/filedatafieldreload/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:reloadfiledatafield }
    requirements:
        datarecord_id: \d+
        datafield_id: \d+

odr_record_save:
    path:  /edit/save/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:update }
    requirements:
        datarecord_id:  \d+
        datafield_id_id:  \d+
odr_record_save_xyzdata:
    path:  /edit/save_xyzdata/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:updatexyzdata }
    requirements:
        datarecord_id:  \d+
        datafield_id_id:  \d+

odr_record_public:
    path:  /edit/publicdatarecord/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicdatarecord }
    requirements:
        datarecord_id:  \d+
odr_record_toggle_prevent_edits:
    path:  /edit/togglepreventedits/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:Edit:toggledatarecordpreventedits }
    requirements:
        datarecord_id:  \d+

odr_record_add:
    path:  /edit/adddatarecord/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Edit:adddatarecord }
    requirements:
        datatype_id:  \d+

odr_record_delete:
    path:  /edit/deletedatarecord/{datarecord_id}/{is_link}/{search_key}    # this path doesn't need {search_theme_id} or {offset}
    defaults: { _controller: ODRAdminBundle:Edit:deletedatarecord, search_key: '' }
    requirements:
        datarecord_id:  \d+
        is_link: 0|1
        search_key: '[a-zA-Z0-9\-\_]*'

odr_record_addchild:
    path:  /edit/addchilddatarecord/{datatype_id}/{parent_id}
    defaults: { _controller: ODRAdminBundle:Edit:addchildrecord }
    requirements:
        datatype_id:  \d+
        parent_id:  \d+

odr_record_rename_file:
    path:  /edit/renamefile/{file_id}
    defaults: { _controller: ODRAdminBundle:Edit:renamefile }
    methods: [ POST ]
    requirements:
        file_id:  \d+

odr_record_rename_image:
    path:  /edit/renameimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Edit:renameimage }
    methods: [ POST ]
    requirements:
        image_id:  \d+

odr_record_file_quality:
    path:  /edit/filequality/{file_id}/{quality}
    defaults: { _controller: ODRAdminBundle:Edit:filequality }
    requirements:
        file_id:  \d+
        quality:  -?\d+

odr_record_image_quality:
    path:  /edit/imagequality/{image_id}/{quality}
    defaults: { _controller: ODRAdminBundle:Edit:imagequality }
    requirements:
        image_id:  \d+
        quality:  -?\d+

odr_record_public_file:
    path:  /edit/publicfile/{file_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicfile }
    requirements:
        file_id:  \d+

odr_record_public_image:
    path:  /edit/publicimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicimage }
    requirements:
        image_id:  \d+

odr_record_delete_file:
    path:  /edit/deletefile/{file_id}
    defaults: { _controller: ODRAdminBundle:Edit:deletefile }
    requirements:
        file_id:  \d+

odr_record_delete_image:
    path:  /edit/deleteimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Edit:deleteimage }
    requirements:
        image_id:  \d+

odr_record_rotate_image:
    path:  /edit/rotateimage/{image_id}/{direction}
    defaults: { _controller: ODRAdminBundle:Edit:rotateimage }
    requirements:
        image_id:  \d+
        direction: -1|1

odr_record_save_image_order:
    path:  /edit/saveimageorder
    defaults: { _controller: ODRAdminBundle:Edit:saveimageorder }
    methods: [ POST ]


odr_record_get_field_history:
    path:  /edit/history/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:getfieldhistory }
    requirements:
        datarecord_id:  \d+
        datafield_id:  \d+
odr_record_get_xyzdata_field_history:
    path:  /edit/history/xyz_data/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:getxyzdatafieldhistory }
    requirements:
        datarecord_id:  \d+
        datafield_id:  \d+

#-----------------------------------------

#-----------------------------------------
# Fake Edit Controller
# NOTE - they're not really "fake" records, per se...but "ephermal" is too wordy
odr_edit_fake_record:
    path:  /edit/create_record/{datatype_id}
    defaults: { _controller: ODRAdminBundle:FakeEdit:fakerecord }
    requirements:
        datatype_id:  \d+

odr_save_fake_record:
    path:  /edit/save_fake_record
    defaults: { _controller: ODRAdminBundle:FakeEdit:savefakerecord }
    methods: [ POST ]

odr_check_fake_record_field_uniqueness:
    path:  /edit/check_fake_record/{datafield_id}/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:FakeEdit:checkfakerecordfieldunique, datarecord_id: '' }
    methods: [ POST ]
    requirements:
        datafield_id: \d+
        datarecord_id: \d+

odr_fake_record_reload_child:
    path: /edit/fake_childreload/{theme_element_id}/{parent_datarecord_id}/{top_level_datarecord_id}
    defaults: { _controller: ODRAdminBundle:FakeEdit:reloadchild }
    methods: [ POST ]
    requirements:
        theme_element_id: \d+
        parent_datarecord_id: \d+
        top_level_datarecord_id: \d+

#-----------------------------------------

#-----------------------------------------
# Radio Options Controller
odr_design_get_radio_options:
    path:  /design/displaytemplate/getradiooptions/{datafield_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:getradiooptionlist }
    requirements:
        datafield_id: \d+

odr_design_add_radio_option:
    path:  /design/displaytemplate/addradiooption/{datafield_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:addradiooption }
    requirements:
        datafield_id:  \d+

odr_design_delete_radio_option:
    path:  /design/displaytemplate/deleteradiooption/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:deleteradiooption }
    requirements:
        radio_option_id:  \d+

odr_design_save_radio_option_name:
    path:  /design/displaytemplate/saveradiooptionname/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:saveradiooptionname }
    methods: [ POST ]
    requirements:
        radio_option_id: \d+

odr_design_default_radio_option:
    path:  /design/displaytemplate/defaultradiooption/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:defaultradiooption }
    requirements:
        radio_option_id:  \d+

odr_design_save_radio_option_order:
    path:  /design/displaytemplate/saveradiooptionorder/{datafield_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:saveradiooptionorder }
    methods: [ POST ]
    requirements:
        datafield_id: \d+

odr_design_save_radio_option_list:
    path:  /design/displaytemplate/saveradiooptionlist/{datafield_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:saveradiooptionlist }
    methods: [ POST ]
    requirements:
        datafield_id:  \d+

odr_record_radio_selection:
    path:  /edit/radioselection/{datarecord_id}/{datafield_id}/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:RadioOptions:radioselection }
    requirements:
        datarecord_id:  \d+
        datafield_id:  \d+
        radio_option_id:  \d+

#-----------------------------------------

#-----------------------------------------
# Tags Controller
odr_get_tag_modal:
    path:  /design/tags/modal/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Tags:loadtagmodal }
    requirements:
        datafield_id: \d+

odr_create_tag:
    path:  /design/tags/create/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Tags:createtag }
    methods: [ POST ]
    requirements:
        datafield_id: \d+

odr_validate_tag_list:
    path:  /design/tags/validate_list/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Tags:validatetaglist }
    requirements:
        datafield_id: \d+

odr_import_tag_list:
    path:  /design/tags/import_list/{datafield_id}/{token}
    defaults: { _controller: ODRAdminBundle:Tags:importtaglist }
    requirements:
        datafield_id: \d+
        token: '|[a-zA-Z0-9\-\_]{15}'

odr_delete_tag:
    path:  /design/tags/delete/{tag_id}
    defaults: { _controller: ODRAdminBundle:Tags:deletetag }
    requirements:
        tag_id: \d+

odr_move_tag:
    path:  /design/tags/move/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Tags:movetag }
    methods: [ POST ]
    requirements:
        datafield_id: \d+

odr_rename_tag:
    path:  /design/tags/rename/{tag_id}
    defaults: { _controller: ODRAdminBundle:Tags:renametag }
    methods: [ POST ]
    requirements:
        tag_id: \d+

odr_tag_selection:
    path:  /edit/tags/selection/{datarecord_id}/{datafield_id}/{tag_id}
    defaults: { _controller: ODRAdminBundle:Tags:tagselection }
    requirements:
        datarecord_id: \d+
        datafield_id: \d+
        tag_id: \d+

#-----------------------------------------

#-----------------------------------------
# Link Controller
odr_design_get_clone_link_templates:
    path:  /design/displaytemplate/getclonelinktemplates/{datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Link:getclonelinktemplates }
    requirements:
        datatype_id:  \d+
        theme_element_id:  \d+

odr_design_clone_and_link_datatype:
    path:  /design/clone_and_link
    defaults: { _controller: ODRAdminBundle:Link:cloneandlink }
    methods: [ POST ]


odr_design_get_link_datatypes:
    path:  /design/displaytemplate/getlinktypes/{datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Link:getlinkabledatatypes }
    requirements:
        datatype_id:  \d+
        theme_element_id:  \d+

odr_design_toggle_secondary_datatree:
    path:  /design/displaytemplate/toggle_secondary/{datatree_id}/{secondary_datatree_id}
    defaults: { _controller: ODRAdminBundle:Link:togglesecondarydatatree }
    requirements:
        datatree_id:  \d+
        secondary_datatree_id:  \d+

odr_design_link_datatype:
    path:  /design/displaytemplate/linktype
    defaults: { _controller: ODRAdminBundle:Link:linkdatatype }
    methods: [ POST ]

odr_design_quicklink_datatype:
    path:  /design/displaytemplate/quicklinktype/{local_datatype_id}/{remote_datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Link:quicklinkdatatype }
    methods: [ GET ]
    requirements:
        local_datatype_id:  \d+
        remote_datatype_id:  \d+
        theme_element_id:  \d+


odr_record_get_linked_datarecords:
    path:  /edit/getlinkedrecords/{local_datarecord_id}
    defaults: { _controller: ODRAdminBundle:Link:getlinkeddatarecords }
    requirements:
        local_datarecord_id: \d+

odr_record_get_linkable_datarecords:
    path:  /edit/getlinkablerecords/{ancestor_datatype_id}/{descendant_datatype_id}/{local_datarecord_id}/{search_theme_id}/{search_key}
    defaults: { _controller: ODRAdminBundle:Link:getlinkabledatarecords, search_theme_id: '', search_key: '' }
    requirements:
        ancestor_datatype_id:  \d+
        descendant_datatype_id:  \d+
        local_datarecord_id:  \d+
        search_theme_id: \d+|''
        search_key: '|[a-zA-Z0-9\-\_]*'

odr_link_datarecords:
    path:  /edit/linkrecords
    defaults: { _controller: ODRAdminBundle:Link:linkdatarecords }
    methods: [ POST ]

odr_unlink_record:
    path:  /edit/unlinkrecord
    defaults: { _controller: ODRAdminBundle:Link:unlinkrecord }
    methods: [ POST ]

odr_record_inline_link:
    path: /edit/inlinelink/{theme_element_id}/{parent_datarecord_id}/{top_level_datarecord_id}
    defaults: { _controller: ODRAdminBundle:Link:loadinlinelink }
    requirements:
        theme_element_id: \d+
        parent_datarecord_id: \d+
        top_level_datarecord_id: \d+

odr_replace_links_page:
    path:  /edit/replace_datarecord_links
    defaults: { _controller: ODRAdminBundle:Link:replacelinkspage }

odr_replace_links_data:
    path:  /edit/replace_link_data
    defaults: { _controller: ODRAdminBundle:Link:replacelinksdata }
    methods: [ POST ]

odr_replace_links_worker:
    path:  /edit/replace_link_worker
    defaults: { _controller: ODRAdminBundle:Link:replacelinksworker }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Display Controller
odr_display_view:
    path:  /view/{datarecord_id}/{search_theme_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Display:view, search_theme_id: 0, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_theme_id: \d+
        search_key: '[a-zA-Z0-9\-\_]*'
        offset: \d+

odr_display_uuid:
    path:  /view/record/{datarecord_uuid}
    defaults: { _controller: ODRAdminBundle:Display:viewuuid }
    requirements:
        datarecord_uuid: '^[a-z0-9]+$'

odr_view_random:
    path:  /view/random/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Display:viewrandom }
    requirements:
        datatype_id:  \d+

#
# Support for old routes and GET routes
#
odr_legacy_results_view:
    path:  /results/view/{datarecord_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Display:legacy_view, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_key: '[a-zA-Z0-9\-\=\|\_]*'
        offset: \d+

odr_legacy_display_view:
    path:  /view/{datarecord_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Display:legacy_view, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_key: '[^\/]*'
        offset: \d+
#
# END Support for old routes and GET routes
#

odr_file_download_start:
    path:  /view/downloadfilestart/{file_id}
    defaults: { _controller: ODRAdminBundle:Display:filedownloadstart }
    requirements:
        file_id:  \d+

odr_file_download:
    path:  /view/downloadfile/{file_id}
    defaults: { _controller: ODRAdminBundle:Display:filedownload }
    requirements:
        file_id:  \d+

odr_image_download:
    path:  /view/downloadimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Display:imagedownload }
    requirements:
        image_id:  \d+

odr_public_image_download:
    path:  /uploads/images/{image_filename}
    defaults: { }
    requirements:
        image_filename: '[a-zA-Z\d\.\_]+'

odr_get_file_list:
    path:  /view/file_list/{grandparent_datarecord_id}/{group_by_datafield}
    defaults: { _controller: ODRAdminBundle:Display:listallfiles, group_by_datafield: 0 }
    requirements:
        grandparent_datarecord_id: \d+
        group_by_datafield: 0|1

odr_start_zip_archive_download:
    path:  /view/start_archive_build/{grandparent_datarecord_id}
    defaults: { _controller: ODRAdminBundle:Display:startdownloadarchive }
    methods: [ POST ]
    requirements:
        grandparent_datarecord_id: \d+

odr_get_search_results_file_list:
    path:  /view/search_file_list/{search_key}
    defaults: { _controller: ODRAdminBundle:Display:listsearchresultfiles }
    requirements:
        search_key: '[a-zA-Z0-9\-\_]*'

odr_start_search_results_archive_download:
    path:  /view/search_archive_build
    defaults: { _controller: ODRAdminBundle:Display:startsearchresultfilesdownload }
    methods: [ POST ]

odr_download_zip_archive:
    path:  /view/zip_archive_download/{archive_filename}
    defaults: { _controller: ODRAdminBundle:Display:downloadarchive }
    requirements:
        archive_filename: 0|[0-9a-zA-Z\-\_]{12}.zip

odr_create_zip_archive_from_filelist:
    path:  /view/archive_from_file_list
    defaults: { _controller: ODRAdminBundle:Display:createziparchivefromfilelist }
    methods: [ POST ]


#-----------------------------------------

#-----------------------------------------
# TextResults Controller
odr_datatables_row_request:
    path:  /beanstalk/datatables/rows
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesrowrequest }
    methods: [ POST ]
odr_datatables_state_save:
    path:  /beanstalk/datatables/state_save
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstatesave }
    methods: [ POST ]
odr_datatables_state_load:
    path:  /beanstalk/datatables/state_load
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstateload }
    methods: [ POST ]
odr_datatables_state_destroy:
    path:  /beanstalk/datatables/state_destroy/{odr_tab_id}
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstatedestroy }
    requirements:
        odr_tab_id: '[a-zA-Z0-9\-\_]{15}|'

odr_textresults_load_linked_datarecords:
    path:  /edit/load_linked_datarecords_table
    defaults: { _controller: ODRAdminBundle:TextResults:loadlinkeddatarecordstable }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# XSD Controller
odr_get_datatype_xsd:
    path:  /admin/schema/datatype/{version}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:XSD:getDatatypeXSD }
    requirements:
        version: 'v1|v2'
        datatype_id: \d+

#-----------------------------------------

#-----------------------------------------
# XMLImport Controller
odr_xml_import:
    path:  /admin/xml_import/{datatype_id}
    defaults: { _controller: ODRAdminBundle:XMLImport:import }
    requirements:
        datatype_id:  \d+

odr_xml_import_start:
    path: /beanstalk/xml_import/start
    defaults: { _controller: ODRAdminBundle:XMLImport:importstart }
    methods: [ POST ]

odr_xml_import_validate:
    path: /beanstalk/xml_import/validate
    defaults: { _controller: ODRAdminBundle:XMLImport:importvalidate }
    methods: [ POST ]

odr_xml_import_worker:
    path: /beanstalk/xml_import/worker
    defaults: { _controller: ODRAdminBundle:XMLImport:importworker }
    methods: [ POST ]

odr_xml_import_file_download:
    path: /beanstalk/xml_import/download_file
    defaults: { _controller: ODRAdminBundle:XMLImport:importfile }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Worker Controller
odr_migrate_field:
    path: /beanstalk/migrate
    defaults: { _controller: ODRAdminBundle:Worker:migrate }
    methods: [ POST ]

#odr_start_rebuild_thumbnails:
#    path: /admin/rebuild_thumbnails/{datatype_id}
#    defaults: { _controller: ODRAdminBundle:Worker:startrebuildthumbnails }
#    requirements:
#        datatype_id: \d+

#odr_rebuild_thumbnails:
#    path: /beanstalk/rebuild_thumbnails
#    defaults: { _controller: ODRAdminBundle:Worker:rebuildthumbnails }
#    methods: [ POST ]

odr_crypto_request:
    path: /beanstalk/crypto_request
    defaults: { _controller: ODRAdminBundle:Worker:cryptorequest }
    methods: [ POST ]

odr_sync_with_template_worker:
    path: /beanstalk/sync_with_template
    defaults: { _controller: ODRAdminBundle:Worker:syncwithtemplate }
    methods: [ POST ]

odr_storage_entity_cleanup:
    path: /admin/start_cleanup
    defaults: { _controller: ODRAdminBundle:Worker:startcleanup }

odr_storage_entity_cleanup_worker:
    path: /beanstalk/storage_entity_cleanup
    defaults: { _controller: ODRAdminBundle:Worker:storageentitycleanup }
    methods: [ POST ]

odr_tag_rebuild_worker:
    path: /beanstalk/tag_rebuild
    defaults: { _controller: ODRAdminBundle:Worker:tagrebuildworker }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# CSVImport Controller
odr_csv_import:
    path: /csvimport/{datatype_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:import }
    requirements:
        datatype_id: \d+

odr_csv_import_delimiter_changed:
    path: /csvimport/delimiter
    defaults: { _controller: ODRAdminBundle:CSVImport:delimiter }
    methods: [ POST ]

odr_csv_file_redownload:
    path: /csvimport/redownload
    defaults: { _controller: ODRAdminBundle:CSVImport:redownloadfile }

odr_csv_refresh_filelist:
    path: /csvimport/filelist/refresh
    defaults: { _controller: ODRAdminBundle:CSVImport:refreshfilelist }
odr_csv_delete_filelist:
    path: /csvimport/filelist/delete
    defaults: { _controller: ODRAdminBundle:CSVImport:deletefilelist }

odr_csv_cancel_import:
    path: /csvimport/cancel
    defaults: { _controller: ODRAdminBundle:CSVImport:cancel }

odr_csv_import_layout:
    path: /csvimport/layout/{source_datatype_id}/{target_datatype_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:layout }
    requirements:
        source_datatype_id: \d+
        target_datatype_id: \d+


odr_csv_import_start_validate:
    path: /csvimport/start_validate
    defaults: { _controller: ODRAdminBundle:CSVImport:startvalidate }
    methods: [ POST ]

odr_csv_import_validate:
    path: /beanstalk/csv_import/validate
    defaults: { _controller: ODRAdminBundle:CSVImport:csvvalidate }
    methods: [ POST ]

odr_csv_import_validate_results:
    path: /beanstalk/csv_import/validate_results/{tracked_job_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:validateresults }
    requirements:
        tracked_job_id: \d+


odr_csv_import_start_worker:
    path: /csvimport/start_worker/{job_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:startworker }
#    requirements: { methods: POST }
    requirements:
        job_id: \d+

odr_csv_import_worker:
    path: /beanstalk/csv_import/worker
    defaults: { _controller: ODRAdminBundle:CSVImport:csvworker }
    methods: [ POST ]

odr_csv_link_worker:
    path: /beanstalk/csv_import/link_worker
    defaults: { _controller: ODRAdminBundle:CSVImport:csvlinkworker }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Flow Controller
odr_flow_upload:
    path: /edit/flow/{upload_type}/{datatype_id}/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Flow:flow, datarecord_id: 0, datafield_id: 0 }
    requirements:
        upload_type: 'xml|csv|file|image|csv_import_file_storage|xml_import_file_storage'
        datatype_id: \d+
        datarecord_id: \d+
        datafield_id: \d+

#-----------------------------------------

#-----------------------------------------
# MassEdit Controller
odr_mass_edit_render:
    path: /admin/massedit/{datatype_id}/{search_theme_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:MassEdit:massEdit, offset: '' }
    requirements:
        datatype_id: \d+
        search_theme_id: \d+
        search_key: '[a-zA-Z0-9\-\_]*'
        offset: \d+


odr_mass_update_start:
    path: /admin/massedit/start
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdate }
    methods: [ POST ]

odr_mass_update_worker_status:
    path: /beanstalk/massedit_status
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdateWorkerStatus }
    methods: [ POST ]

odr_mass_update_worker_values:
    path: /beanstalk/massedit_values
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdateWorkerValues }
    methods: [ POST ]


odr_mass_delete:
    path: /admin/massdelete/{datatype_id}/{odr_tab_id}
    defaults: { _controller: ODRAdminBundle:MassEdit:massDelete }
    requirements:
        datatype_id: \d+
        odr_tab_id: '[a-zA-Z0-9\-\_]{15}|'

#-----------------------------------------

#-----------------------------------------
# CSVExport Controller
odr_csv_export_render:
    path: /csvexport/{datatype_id}/{search_theme_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExport, offset: '' }
    requirements:
        datatype_id: \d+
        search_theme_id: \d+
        search_key: '[a-zA-Z0-9\-\_]*'
        offset: \d+

odr_csv_export_start_express:
    path: /csvexport/express
    defaults: { _controller: ODRAdminBundle:CSVExport:newCsvExportStart }
    methods: [ POST ]
#odr_csv_export_start:
#    path: /csvexport/start
#    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportStart }
#    methods: [ POST ]

odr_csv_export_worker:
    path: /beanstalk/csvexport/worker
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportWorker }
    methods: [ POST ]

#odr_csv_export_finalize:
#    path: /beanstalk/csvexport/finalize
#    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportFinalize }
#    methods: [ POST ]


odr_csv_download:
    path:  /csvexport/download/{user_id}/{tracked_job_id}
    defaults: { _controller: ODRAdminBundle:CSVExport:downloadCSV }
    requirements:
        user_id: \d+
        tracked_job_id: \d+

#-----------------------------------------

#-----------------------------------------
# Job Controller
odr_job_list:
    path:  /jobs/list/{section}
    defaults: { _controller: ODRAdminBundle:Job:list, section: '' }
    requirements:
        section: '|migrate|tag_rebuild|mass_edit|csv_import_validate|csv_import|csv_export'

odr_my_jobs:
    path:  /jobs/my
    defaults: { _controller: ODRAdminBundle:Job:myjobs }

odr_job_refresh:
    path:  /jobs/refresh/{job_type}/{job_id}
    defaults: { _controller: ODRAdminBundle:Job:refresh, job_id: 0 }
    requirements:
        job_type: '|recache|migrate|tag_rebuild|mass_edit|rebuild_thumbnails|csv_import|csv_import_validate|csv_export|clone_and_link'
        job_id: \d+

#odr_get_job_errors:
#    path:  /jobs/geterrors/{job_id}
#    defaults: { _controller: ODRAdminBundle:Job:getjoberrors }
#    requirements:
#        job_id: \d+

#odr_delete_job_errors:
#    path:  /jobs/delete_errors/{job_id}
#    defaults: { _controller: ODRAdminBundle:Job:deletejoberrors }
#    requirements:
#        job_id: \d+

odr_job_viewed:
    path:  /jobs/viewed/{job_ids}
    defaults: { _controller: ODRAdminBundle:Job:viewed }
    requirements:
        job_ids: '[\d\,]+'

odr_delete_user_job:
    path:  /jobs/delete/{job_id}
    defaults: { _controller: ODRAdminBundle:Job:delete }
    requirements:
        job_id: \d+

#-----------------------------------------
odr_delete_tracked_job:
    path:  /jobs/delete_job/{job_id}
    defaults: { _controller: ODRAdminBundle:Job:deletejob }
    requirements:
        job_id: \d+

#-----------------------------------------

#-----------------------------------------
# Reports Controller
odr_design_analyze_datafield_unique:
    path:  /design/displaytemplate/analyze_datafield_unique/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldunique }
    requirements:
        datafield_id:  \d+

odr_design_analyze_file_uploads:
    path:  /design/displaytemplate/analyze_file_uploads/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzefileuploads }
    requirements:
        datafield_id:  \d+

odr_design_analyze_datarecord_number:
    path:  /design/displaytemplate/analyze_datarecord_number/{datatree_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatarecordnumber }
    requirements:
        datatree_id: \d+

odr_design_analyze_datarecord_links:
    path:  /design/displaytemplate/analyze_datarecord_links/{local_datatype_id}/{remote_datatype_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatarecordlinks }
    requirements:
        local_datatype_id: \d+
        remote_datatype_id: \d+

odr_design_analyze_datafield_content:
    path:  /edit/record/analyze_datafield_content/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldcontent }
    requirements:
        datafield_id: \d+

odr_design_analyze_radio_selections:
    path:  /edit/record/analyze_radio_selections/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzeradioselections }
    requirements:
        datafield_id: \d+

odr_design_analyze_datafield_migration_start:
    path:  /edit/record/analyze_datafield_migration/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldmigrationstart }
    requirements:
        datafield_id: \d+
odr_design_analyze_datafield_migration:
    path:  /edit/record/analyze_datafield_migration
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldmigration }
    methods: [ POST ]

odr_get_file_decrypt_progress:
    path:  /view/decrypt_progress/file/{file_id}
    defaults: { _controller: ODRAdminBundle:Reports:getfiledecryptprogress }
    requirements:
        file_id: \d+
odr_get_file_encrypt_progress:
    path:  /view/encrypt_progress/file/{file_id}
    defaults: { _controller: ODRAdminBundle:Reports:getfileencryptprogress }
    requirements:
        file_id: \d+
odr_file_encrypt_retry:
    path:  /view/encrypt_retry/file/{file_id}
    defaults: { _controller: ODRAdminBundle:Reports:fileencryptretry }
    requirements:
        file_id: \d+
odr_get_zip_archive_progress:
    path:  /view/zip_archive_progress/{archive_filename}
    defaults: { _controller: ODRAdminBundle:Reports:getziparchiveprogress }
    requirements:
        archive_filename: 0|[0-9a-zA-Z\-\_]{12}.zip

#-----------------------------------------

#-----------------------------------------
# Validation Controller
# These routes are in order of how they should be run...later routes may suggest or make nonsensical
#  changes if the previous routes haven't been run beforehand

# Ensures dates aren't in a "0000-00-00 ..." format
odr_fix_database_dates:
    path: /admin/fix_dates
    defaults: { _controller: ODRAdminBundle:Validation:fixdatabasedates }
# Child datatypes must have a null search slug
odr_childtype_search_slug_fix:
    path: /admin/childtype_search_slug_fix
    defaults: { _controller: ODRAdminBundle:Validation:childsearchslugfix }
# Locate duplicate (user, group) pairs in the UserGroup table
odr_find_duplicate_user_groups:
    path: /admin/find_duplicate_user_groups
    defaults: { _controller: ODRAdminBundle:Validation:findduplicateusergroups }
# Ensure all fieldtype entries exist and have the correct properties
odr_check_fieldtype_table:
    path:  /admin/check_fieldtype_table
    defaults: { _controller: ODRAdminBundle:Validation:checkFieldtypeTable }

# Ensure entities don't share uuids
odr_fix_duplicate_uuids:
    path:  /admin/fix_duplicate_uuids
    defaults: { _controller: ODRAdminBundle:Validation:fixduplicateuuids }
# Ensure datafields with a master_datafield_id also have a template_field_uuid
odr_fix_missing_datafield_template_uuids:
    path:  /admin/fix_missing_datafield_template_uuids
    defaults: { _controller: ODRAdminBundle:Validation:fixmissingdatafielduuids }

# Locates entities without meta entries
odr_fix_missing_meta_entries:
    path: /admin/fix_meta_entries
    defaults: { _controller: ODRAdminBundle:Validation:fixmissingmetaentries }
# Locates multiple meta entries that refer to the same entity
odr_find_duplicate_meta_entries:
    path: /admin/find_duplicate_meta_entries
    defaults: { _controller: ODRAdminBundle:Validation:findduplicatemetaentries }
# Locates duplicate datatypeSpecialField entries
odr_find_duplicate_dtsf_entries:
    path: /admin/find_duplicate_dtsf_entries
    defaults: { _controller: ODRAdminBundle:Validation:findduplicatespecialfields }
# Locates duplicate storage entity entries
odr_find_duplicate_drf_entries:
    path: /admin/find_duplicate_drf_entries
    defaults: { _controller: ODRAdminBundle:Validation:findduplicatedrfentries }

odr_find_invalid_drf_entries:
    path: /admin/find_invalid_drf_entries/{type}
    defaults: { _controller: ODRAdminBundle:Validation:findinvaliddrfentries }
    requirements:
        type: boolean|integer|decimal|shortvarchar|mediumvarchar|longvarchar|longtext|datetime
odr_find_duplicate_storage_entries:
    path: /admin/find_duplicate_storage_entries/{type}
    defaults: { _controller: ODRAdminBundle:Validation:findduplicatestorageentries }
    requirements:
        type: boolean|integer|decimal|shortvarchar|mediumvarchar|longvarchar|longtext|datetime
odr_find_orphaned_storage_entries:
    path: /admin/find_orphaned_storage_entries/{type}
    defaults: { _controller: ODRAdminBundle:Validation:findorphanedstorageentries }
    requirements:
        type: boolean|integer|decimal|shortvarchar|mediumvarchar|longvarchar|longtext|datetime

# Locate/delete a pile of child entities that make no sense when their parent entities are deleted
# This needs to be run repeatedly until it stops making changes
odr_find_orphaned_entities:
    path: /admin/find_orphaned_entities
    defaults: { _controller: ODRAdminBundle:Validation:findorphanedentities }
# Locates meta entries that refer to deleted entities
odr_find_undeleted_meta_entries:
    path: /admin/find_undeleted_meta_entries
    defaults: { _controller: ODRAdminBundle:Validation:findundeletedmetaentries }
# Datatypes aren't allowed to claim exterinal_id/name/background_image fields from other datatypes
odr_find_datatype_meta_errors:
    path: /admin/find_datatype_meta_errors
    defaults: { _controller: ODRAdminBundle:Validation:finddatatypemetaerrors }

# Theme_elements aren't allowed to have both theme_datatype and theme_datafield entries
odr_find_overachieving_theme_elements:
    path:  /admin/find_overachieving_theme_elements
    defaults: { _controller: ODRAdminBundle:Validation:themeElementcheck }
# Ensures the values stored in the Theme -> ThemeElement -> ThemeDataType tables match the DataTree entities
odr_fix_datatree_entries:
    path: /admin/fix_datatree_entries
    defaults: { _controller: ODRAdminBundle:Validation:fixdatatreeentries }
# zeta/epsilon has a whole mess of problems related to themes...
odr_find_datatypes_without_master_themes:
    path:  /admin/find_datatypes_without_master_themes/{check_top_level}
    defaults: { _controller: ODRAdminBundle:Validation:finddatatypeswithoutmasterthemes }
    requirements:
        check_top_level: 0|1

odr_fix_render_plugin_instances:
    path: /admin/fix_render_plugin_instances
    defaults: { _controller: ODRAdminBundle:Validation:fixrenderplugininstances }

# Locate themes that have the same parent_theme_id, but there's no theme_datatype trail to reach them
# Unsure what to do about this one...the problems it finds can't be easily fixed
odr_trace_theme_ancestory:
    path: /admin/trace_theme_ancestory
    defaults: { _controller: ODRAdminBundle:Validation:tracethemeancestory }

odr_compare_datatypes:
    path:  /admin/type/compare/{left_datatype_id}/{right_datatype_id}/{filter}
    defaults: { _controller:  ODRAdminBundle:Validation:comparedatatypes, filter: 1 }
    requirements:
        left_datatype_id: \d+
        right_datatype_id: \d+
        filter: 0|1

odr_purge_datatype:
    path: /admin/purge/{datatype_ids}
    defaults: { _controller: ODRAdminBundle:Validation:purge }
    requirements:
        datatype_ids: "^[0-9,]+$"

odr_purge_deleted_records:
    path: /admin/purge_deleted_records/{datatype_ids}
    defaults: { _controller: ODRAdminBundle:Validation:purgedeletedrecords }
    requirements:
        datatype_ids: "^[0-9,]+$"

odr_purge_files:
    path: /admin/purge_files
    defaults: { _controller: ODRAdminBundle:Validation:purgefiles }


#-----------------------------------------

#-----------------------------------------
# Session Controller
odr_session_pagelength:
    path:  /session/pagelength/{length}
    defaults: { _controller: ODRAdminBundle:Session:pagelength }
    requirements:
        length: 10|25|50|100

odr_session_searchlink_pagelength:
    path:  /session/searchlinkpagelength/{remote_datatype_id}/{length}
    defaults: { _controller: ODRAdminBundle:Session:searchlinkpagelength }
    requirements:
        remote_datatype_id: \d+
        length: 10|25|50|100

odr_session_toggle_show_editable:
    path:  /session/toggle/show_editable
    defaults: { _controller: ODRAdminBundle:Session:toggleshoweditable }
    methods: [ POST ]
odr_session_toggle_edit_shows_all:
    path:  /session/toggle/edit_shows_all
    defaults: { _controller: ODRAdminBundle:Session:editshowsall }
    methods: [ POST ]

odr_apply_sidebar_layout:
    path:  /session/apply_sidebar_layout/{datatype_id}/{intent}/{sidebar_layout_id}/{persist}
    defaults: { _controller: ODRAdminBundle:Session:applysidebarlayout }
    requirements:
        datatype_id:  \d+
        intent:  '|searching|linking'
        sidebar_layout_id:  \d+
        persist: 0|1

odr_apply_theme:
    path:  /session/apply_theme/apply/{datatype_id}/{page_type}/{theme_id}/{persist}
    defaults: { _controller: ODRAdminBundle:Session:applytheme }
    requirements:
        datatype_id:  \d+
        page_type:  '|search_results|display|edit|linking'
        theme_id:  \d+
        persist: 0|1

#-----------------------------------------


#-----------------------------------------
# Migration Controller
odr_migrate_1.0:
    path:  /admin/migrate/1.0
    defaults: { _controller: ODRAdminBundle:Migration:migrate_1_0_ }
odr_migrate_1.1:
    path:  /admin/migrate/1.1
    defaults: { _controller: ODRAdminBundle:Migration:migrate_1_1_ }


odr_render_datatype_array:
    path:  /admin/get_datatype_array/{side}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Migration:renderdatatypearray }
    requirements:
        side: '|src|dest'
        datatype_id: \d+
odr_render_radio_options_array:
    path:  /admin/get_radio_options_array/{src_datafield_id}/{dest_datafield_id}
    defaults: { _controller: ODRAdminBundle:Migration:renderradiooptionsarray }
    requirements:
        src_datafield_id: \d+
        dest_datafield_id: \d+

odr_create_template_from_datatype_start:
    path:  /admin/create_template_from_datatype
    defaults: { _controller: ODRAdminBundle:Migration:createtemplatefromdatatypestart }
odr_create_template_from_datatype:
    path:  /admin/create_template_from_datatype_post
    defaults: { _controller: ODRAdminBundle:Migration:createtemplatefromdatatype }
    methods: POST

odr_make_datatype_use_template_start:
    path:  /admin/make_datatype_use_template
    defaults: { _controller: ODRAdminBundle:Migration:makedatatypeusetemplatestart }
odr_make_datatype_use_template:
    path:  /admin/make_datatype_use_template_post
    defaults: { _controller: ODRAdminBundle:Migration:makedatatypeusetemplate }
    methods: POST

odr_move_datatype_contents_start:
    path:  /admin/move_datatype_contents
    defaults: { _controller: ODRAdminBundle:Migration:movedatatypecontentsstart }
odr_move_datatype_contents:
    path:  /admin/move_datatype_contents_post
    defaults: { _controller: ODRAdminBundle:Migration:movedatatypecontents }
    methods: POST

odr_convert_link_to_childtype_start:
    path:  /admin/convert_link_to_childtype
    defaults: { _controller: ODRAdminBundle:Migration:convertlinktochildtypestart }
odr_convert_link_to_childtype:
    path:  /admin/convert_link_to_childtype_post
    defaults: { _controller: ODRAdminBundle:Migration:convertlinktochildtype }
    methods: POST

odr_convert_childtype_to_link_start:
    path:  /admin/convert_childtype_to_link
    defaults: { _controller: ODRAdminBundle:Migration:convertchildtypetolinkstart }
odr_convert_childtype_to_link:
    path:  /admin/convert_childtype_to_link_post
    defaults: { _controller: ODRAdminBundle:Migration:convertchildtypetolink }
    methods: POST

#-----------------------------------------
# Tracking Controller
#odr_track_datafield_changes:
#    path:  /admin/track/datafield/{datafield_id}
#    defaults: { _controller: ODRAdminBundle:Tracking:trackdatafieldchanges }
#    requirements:
#        datafield_id: \d+

odr_track_datarecord_changes:
    path: /admin/track/datarecord/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:Tracking:trackdatarecordchanges }
    requirements:
        datarecord_id: \d+

odr_track_search_result_changes:
    path: /admin/track/search/{search_key}
    defaults: { _controller: ODRAdminBundle:Tracking:tracksearchresultchanges }
    requirements:
        search_key: '[^\/]*'

odr_track_datatype_changes:
    path:  /admin/track/datatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Tracking:trackdatatypechanges }
    requirements:
        datatype_id: \d+

odr_track_user_changes:
    path: /admin/track/user/{target_user_id}
    defaults: { _controller: ODRAdminBundle:Tracking:trackuserchanges }
    requirements:
        target_user_id: \d+


odr_track_changes:
    path: /admin/track/changes
    defaults: { _controller: ODRAdminBundle:Tracking:trackchanges }
    methods: [POST]


odr_track_get_datafield_selector:
    path: /admin/track/datafield_list/{datatype_id_restriction}
    defaults: { _controller: ODRAdminBundle:Tracking:getdatafieldselector, datatype_id_restriction: '' }
    requirements:
        datatype_id_restriction: \d+

odr_track_get_user_selector:
    path: /admin/track/user_list
    defaults: { _controller: ODRAdminBundle:Tracking:getuserselector }
#-----------------------------------------

#-----------------------------------------
# Trigger Controller
odr_trigger_home:
    path: /admin/trigger/home/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Trigger:home }
    requirements:
        datatype_id: \d+

odr_trigger_datatype_cache_wipe:
    path: /admin/trigger/datatype_cache_wipe/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Trigger:triggerdatatypecachewipe }
    requirements:
        datatype_id: \d+

odr_trigger_datafield_cache_wipe:
    path: /admin/trigger/datafield_cache_wipe/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Trigger:triggerdatafieldcachewipe }
    requirements:
        datafield_id: \d+

odr_trigger_tag_rebuild:
    path: /admin/trigger/tag_rebuild/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Trigger:triggertagrebuild }
    requirements:
        datafield_id: \d+

#-----------------------------------------

#-----------------------------------------
# Debug Controller
# The routes in here probably should be commented out unless actively being tested

# Controller action to be able to use xdebug on the worker process of CSVExport, instead of having
#  to repeatedly run jobs and read logs...the finalize process can't be debugged, but is simple enough
#  that it shouldn't be needed
#odr_debug_csv_export_start:
#    path: /admin/debug_csv_export/{datatype_id}/{search_key}
#    defaults: { _controller: ODRAdminBundle:Debug:debugcsvexportstart, search_key: '' }
#    requirements:
#        datatype_id: \d+
#        search_key: '[a-zA-Z0-9\-\_]*'

#odr_debug_csv_export:
#    path: /admin/debug_csv_export
#    defaults: { _controller: ODRAdminBundle:Debug:debugcsvexport }
#    methods: [POST]
#-----------------------------------------

odr_amcsd_update_trigger:
    path: /admin/amcsd/trigger
    defaults: { _controller: ODRAdminBundle:Worker:amcsdupdatetrigger }

odr_asdf:
    path: /admin/asdf/
    defaults: { _controller: ODRAdminBundle:Worker:asdf }

#odr_qwer:
#    path: /admin/qwer/
#    defaults: { _controller: ODRAdminBundle:Worker:qwer }
#
#odr_zxcv:
#    path: /admin/zxcv/
#    defaults: { _controller: ODRAdminBundle:Worker:zxcv }

imports:
    resource: api.yml
