#-----------------------------------------
# Basic routes
odr_admin_homepage:
    path:  /admin
    defaults: { _controller: ODRAdminBundle:Default:index }

odr_logout:
    path:  /logout

odr_dashboard:
    defaults: { _controller: ODRAdminBundle:Default:dashboard }
    path:  /admin/dashboard

#-----------------------------------------

#-----------------------------------------
# ODRUser Controller
# public routes to let users modify their own profile
odr_self_profile_edit:
    path:  /profile/edit
    defaults: { _controller: ODRAdminBundle:ODRUser:selfeditprofile }

odr_self_profile_save:
    path:  /profile/save
    defaults: { _controller: ODRAdminBundle:ODRUser:selfsaveprofile }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# ODRUser Controller
odr_admin_new_user_create:
    path:  /admin/new_user/create
    defaults: { _controller: ODRAdminBundle:ODRUser:createnewuser }

odr_admin_new_user_check:
    path:  /admin/new_user/check_email
    defaults: { _controller: ODRAdminBundle:ODRUser:checkemailexistence }
    methods: [ POST ]

odr_admin_new_user_save:
    path: /admin/new_user/save
    defaults: { _controller: ODRAdminBundle:ODRUser:savenewuser }
    methods: [ POST ]

odr_admin_change_password:
    path:  /admin/user/change_password/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:changepassword }
    requirements:
        user_id:  \d+

odr_admin_save_password:
    path:  /admin/user/change_password/save
    defaults: { _controller: ODRAdminBundle:ODRUser:savepassword }
    methods: [ POST ]

odr_profile_edit:
    path:  /admin/user/edit/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:editprofile }
    requirements:
        user_id:  \d+

odr_profile_save:
    path:  /admin/user/save
    defaults: { _controller: ODRAdminBundle:ODRUser:saveprofile }
    methods: [ POST ]

odr_user_list:
    path:  /admin/user/list
    defaults: { _controller: ODRAdminBundle:ODRUser:listusers }

odr_manage_user_roles:
    path:  /admin/user/manage/roles
    defaults: { _controller: ODRAdminBundle:ODRUser:manageroles }

odr_set_user_role:
    path:  /admin/user/setrole/{user_id}/{role}
    defaults: { _controller: ODRAdminBundle:ODRUser:setrole }
    requirements:
        user_id:  \d+
        role:  '|user|admin|sadmin|jupyterhub'

odr_delete_user:
    path:  /admin/user/delete/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:deleteuser }
    requirements:
        user_id:  \d+

odr_undelete_user:
    path:  /admin/user/undelete/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:undeleteuser }
    requirements:
        user_id:  \d+

odr_session_pagelength:
    path:  /session/pagelength/{length}
    defaults: { _controller:ODRAdminBundle:ODRUser:pagelength }
    requirements:
        length: 10|25|50|100

odr_view_effective_permissions:
    path:  /admin/user/view_as/{user_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:vieweffectivepermissions }
    requirements:
        user_id:  \d+
        datatype_id:  \d+

odr_view_permissions_result:
    path:  /admin/user/view_theme/{user_id}/{theme_id}
    defaults: { _controller: ODRAdminBundle:ODRUser:viewpermissionsresult }
    requirements:
        user_id:  \d+
        theme_id:  \d+
#-----------------------------------------

#-----------------------------------------
# ODRGroup Controller
odr_manage_groups:
    path:  /admin/group/manange/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:managegroups }
    requirements:
        datatype_id:  \d+

odr_load_group_list:
    path:  /admin/group/list/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:grouplist }
    requirements:
        datatype_id:  \d+

odr_add_group:
    path:  /admin/group/add/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:addgroup }
    requirements:
        datatype_id:  \d+

odr_delete_group:
    path:  /admin/group/delete/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:deletegroup }
    requirements:
        group_id:  \d+

odr_group_properties:
    path:  /admin/group/load/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:groupproperties }
    requirements:
        group_id:  \d+

odr_group_membership:
    path:  /admin/group/members/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:groupmembers }
    requirements:
        group_id:  \d+

odr_datatype_group_membership:
    path:  /admin/group/members_datatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:datatypegroupmembers }
    requirements:
        datatype_id:  \d+


odr_manage_user_groups:
    path:  /admin/user/managegroups/{user_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:manageusergroups }
    requirements:
        user_id:  \d+

odr_change_user_group:
    path:  /admin/user/changegroup/{user_id}/{group_id}/{value}
    defaults: { _controller: ODRAdminBundle:ODRGroup:changeusergroup }
    requirements:
        user_id:  \d+
        group_id:  \d+
        value:  0|1


odr_manage_group_permissions:
    path:  /admin/group/permissions/{group_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:grouppermissions }
    requirements:
        group_id:  \d+

odr_group_permissions_reload_childtype:
    path:  /admin/group/permissions/reload/childtype/{group_id}/{source_datatype_id}/{childtype_id}
    defaults: { _controller: ODRAdminBundle:ODRGroup:reloadchildtype }
    requirements:
        group_id:  \d+
        source_datatype_id:  \d+
        childtype_id:  \d+

#odr_group_permissions_reload_theme_element:
#    path:  /admin/group/permissions/reload/theme_element/{group_id}/{source_datatype_id}/{theme_element_id}
#    defaults: { _controller: ODRAdminBundle:ODRGroup:reloadthemeelement }
#    requirements:
#        group_id:  \d+
#        source_datatype_id:  \d+
#        theme_element_id:  \d+


odr_save_group_datatype_permission:
    path:  /admin/group/savepermissions/datatype/{group_id}/{datatype_id}/{value}/{permission}
    defaults: { _controller: ODRAdminBundle:ODRGroup:savedatatypepermission }
    requirements:
        group_id:  \d+
        datatype_id:  \d+
        value: '0|1'
        permission:  'dt_view|dr_view|dr_add|dr_delete|dt_admin|'

odr_save_group_datafield_permission:
    path:  /admin/group/savepermissions/datafield/{group_id}/{datafield_id}/{value}
    defaults: { _controller: ODRAdminBundle:ODRGroup:savedatafieldpermission }
    requirements:
        group_id:  \d+
        datafield_id:  \d+
        value: '0|1|2'
#-----------------------------------------

#-----------------------------------------
# Render Plugin routes
odr_render_plugin_dialog:
    path:  /design/displaytemplate/plugindialog/{datatype_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:plugindialog }
    requirements:
        datatype_id:  \d+
        datafield_id:  \d+

odr_load_plugin_data:
    path:  /design/displaytemplate/plugindata/{datatype_id}/{datafield_id}/{render_plugin_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:pluginsettings }
    requirements:
        datatype_id:  \d+
        datafield_id:  \d+
        render_plugin_id:  \d+

odr_save_render_plugin_settings:
    path:  /design/displaytemplate/saverenderpluginsettings
    defaults: { _controller: ODRAdminBundle:Displaytemplate:saverenderpluginsettings }
    methods: [ POST ]

admin_manage_plugins:
    path:  /admin/plugins
    defaults: { _controller: ODRAdminBundle:Plugins:manage }

admin_plugin_add:
    path:  /admin/plugin/add
    defaults: { _controller: ODRAdminBundle:Plugins:add }
    requirements:
        plugin_name:  \w+

admin_plugin_map:
    path:  /admin/plugin/map/{plugin_id}
    defaults: { _controller: ODRAdminBundle:Plugins:map }
    requirements:
        plugin_id:  \d+

admin_plugin_options:
    path:  /admin/plugin/options/{plugin_id}
    defaults: { _controller: ODRAdminBundle:Plugins:options }
    requirements:
        plugin_id:  \d+

admin_plugin_test:
    path:  /admin/plugintest
    defaults: { _controller: ODRAdminBundle:Plugins:plugintest }

#-----------------------------------------

#-----------------------------------------
# DataType Controller
odr_list_types:
    path:  /admin/type/list/{section}
    defaults: { _controller: ODRAdminBundle:Datatype:list }
    requirements:
        section: design|records|master

odr_create_type:
    path:  /admin/type/create/{create_master}
    defaults: { _controller: ODRAdminBundle:Datatype:create }
    requirements:
        create_master: 0|1

odr_create_type_info:
    path:  /admin/type/create/info/{template_choice}/{creating_master_template}
    defaults: { _controller: ODRAdminBundle:Datatype:createinfo }
    requirements:
        template_choice: \d+
        creating_master_template: 0|1

odr_add_types:
    path:  /admin/type/add
    defaults: { _controller: ODRAdminBundle:Datatype:add }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Theme Controller
odr_clone_theme:
    path:  /design/view/{datatype_id}/{theme_id}
    defaults: { _controller:ODRAdminBundle:Theme:userclonetheme }
    requirements:
        datatype_id:  \d+
        theme_id:  \d+

odr_design_derivative_themes:
    path:  /design/searchtemplate/{datatype_id}
    defaults: { _controller:ODRAdminBundle:Theme:design }
    requirements:
        datatype_id:  \d+

odr_design_load_theme_list:
    path:  /design/theme/load_all/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadThemeList }
    requirements:
        datatype_id:  \d+

odr_design_add_theme:
    path:  /design/theme/add/{datatype_id}/{theme_type}
    defaults: { _controller: ODRAdminBundle:Theme:addtheme }
    requirements:
        datatype_id:  \d+
        theme_type: 'derivative|search_results|table|'

odr_design_load_theme:
    path:  /design/theme/load/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadtheme }
    requirements:
        theme_id:  \d+

odr_derivative_reload_theme_element:
    path: /design/searchtemplate/themeelementreload/{source_datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:reloadthemeelement }
    requirements:
        source_datatype_id: \d+
        theme_element_id: \d+

odr_design_delete_theme:
    path:  /design/theme/delete/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:deletetheme }
    requirements:
        theme_id:  \d+

odr_design_get_theme_properties:
    path:  /design/theme/properties/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeproperties }
    requirements:
        theme_id:  \d+


odr_design_add_theme_element:
    path:  /design/themeelement/add/{theme_id}
    defaults: { _controller: ODRAdminBundle:Theme:addthemeelement }
    requirements:
        theme_id:  \d+

odr_design_delete_theme_element:
    path:  /design/themeelement/delete/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:deletethemeelement }
    requirements:
        theme_element_id:  \d+

odr_design_get_theme_element_properties:
    path:  /design/themeelement/properties/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:themeelementproperties }
    requirements:
        theme_element_id:  \d+

odr_design_save_theme_element_order:
    path:  /design/themeelement/order
    defaults: { _controller: ODRAdminBundle:Theme:themeelementorder }
    methods: [ POST ]

odr_design_attach_datafield:
    path:  /design/theme/attachdatafield/{datafield_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:attachdatafield }
    requirements:
        datafield_id: \d+
        theme_element_id: \d+

odr_design_detach_datafield:
    path:  /design/theme/detachdatafield/{datafield_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:detachdatafield }
    requirements:
        datafield_id: \d+
        theme_element_id: \d+

odr_design_save_datafield_order:
    path:  /design/theme/datafieldorder/{initial_theme_element_id}/{ending_theme_element_id}
    defaults: { _controller: ODRAdminBundle:Theme:datafieldorder }
    methods: [ POST ]
    requirements:
        initial_theme_element_id: \d+
        ending_theme_element_id: \d+

odr_design_load_theme_datafield:
    path:  /design/theme/loadthemedatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadthemedatafield }
    requirements:
        datafield_id: \d+
        theme_element_id: \d+

# Save routes should not need parameters
odr_design_save_theme_datafield:
    path:  /design/theme/savethemedatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Theme:savethemedatafield }
    methods: [ POST ]
    requirements:
        theme_element_id: \d+
        datafield_id: \d+

odr_design_load_theme_datatype:
    path:  /design/theme/loadthemedatatype/{theme_element_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Theme:loadthemedatatype }
    requirements:
        theme_element_id: \d+
        datatype_id: \d+

# Save routes should not need parameters
odr_design_save_theme_datatype:
    path:  /design/theme/savethemedatatype/{theme_element_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Theme:savethemedatatype }
    methods: [ POST ]
    requirements:
        theme_element_id: \d+
        datatype_id: \d+

#-----------------------------------------

#-----------------------------------------
# Displaytemplate Controller
odr_design_master_theme:
    path:  /design/displaytemplate/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:design }
    requirements:
        datatype_id:  \d+

odr_design_reload_child:
    path: /design/displaytemplate/childreload/{source_datatype_id}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:reloadchild }
    requirements:
        source_datatype_id: \d+
        datatype_id: \d+

odr_design_reload_theme_element:
    path: /design/displaytemplate/themeelementreload/{source_datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:reloadthemeelement }
    requirements:
        source_datatype_id: \d+
        theme_element_id: \d+

odr_design_reload_datafield:
    path: /design/displaytemplate/datafieldreload/{source_datatype_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:reloaddatafield }
    requirements:
        source_datatype_id: \d+
        datafield_id: \d+


odr_design_get_datatype_properties:
    path:  /design/displaytemplate/datatypeproperties/{datatype_id}/{parent_datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datatypeproperties, parent_datatype_id: '' }
    requirements:
        datatype_id:  \d+
        parent_datatype_id: \d+

odr_design_save_datatree:
    path:  /design/displaytemplate/savedatatree/{datatree_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:savedatatree }
    methods: [ POST ]
    requirements:
        datatree_id: \d+

odr_design_get_link_datatypes:
    path:  /design/displaytemplate/getlinktypes/{datatype_id}/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getlinkabledatatypes }
    requirements:
        datatype_id:  \d+
        theme_element_id:  \d+

odr_design_link_datatype:
    path:  /design/displaytemplate/linktype
    defaults: { _controller: ODRAdminBundle:Displaytemplate:linkdatatype }
    methods: [ POST ]

odr_design_get_datafield_properties:
    path:  /design/displaytemplate/datafieldproperties/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datafieldproperties }
    requirements:
        datafield_id:  \d+

odr_design_delete_datafield:
    path:  /design/displaytemplate/deletefield/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:deletedatafield }
    requirements:
        datafield_id:  \d+

odr_design_get_deleted_datafields:
    path:  /design/deleted/datafields/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getdeleteddatafields }
    requirements:
        datatype_id:  \d+

odr_design_undelete_datafield:
    path:  /design/undelete/datafield
    defaults: { _controller: ODRAdminBundle:Displaytemplate:undeletedatafield }
    methods: [ POST ]

odr_design_delete_datatype:
    path:  /design/displaytemplate/deletedatatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:deletedatatype }    # deals with both top-level and child datatypes
    requirements:
        datatype_id:  \d+

odr_design_add_childtype:
    path:  /design/displaytemplate/addchilddatatype/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:addchilddatatype }
    requirements:
        theme_element_id:  \d+

odr_design_add_datafield:
    path:  /design/displaytemplate/adddatafield/{theme_element_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:adddatafield }
    requirements:
        theme_element_id:  \d+

odr_design_copy_datafield:
    path:  /design/displaytemplate/copydatafield/{theme_element_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:copydatafield }
    requirements:
        theme_element_id:  \d+
        datafield_id:  \d+

odr_design_get_radio_options:
    path:  /design/displaytemplate/getradiooptions/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:getradiooptions }
    requirements:
        datafield_id: \d+
odr_design_save_radio_option_name:
    path:  /design/displaytemplate/saveradiooptionname/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:radiooptionname }
    methods: [ POST ]
    requirements:
        radio_option_id: \d+
odr_design_save_radio_option_order:
    path:  /design/displaytemplate/saveradiooptionorder/{datafield_id}/{alphabetical_sort}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:radiooptionorder }
    methods: [ POST ]
    requirements:
        datafield_id: \d+
        alphabetical_sort: 0|1
odr_design_add_radio_option:
    path:  /design/displaytemplate/addradiooption/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:addradiooption }
    requirements:
        datafield_id:  \d+
odr_design_default_radio_option:
    path:  /design/displaytemplate/defaultradiooption/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:defaultradiooption }
    requirements:
        radio_option_id:  \d+
odr_design_delete_radio_option:
    path:  /design/displaytemplate/deleteradiooption/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:deleteradiooption }
    requirements:
        radio_option_id:  \d+


odr_design_public_datatype:
    path:  /design/displaytemplate/publicdatatype/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datatypepublic }
    requirements:
        datatype_id:  \d+

odr_design_public_datafield:
    path:  /design/displaytemplate/publicdatafield/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Displaytemplate:datafieldpublic }
    requirements:
        datafield_id:  \d+

odr_markdown_help_dialog:
    path:  /design/displaytemplate/markdownhelp
    defaults: { _controller: ODRAdminBundle:Displaytemplate:markdownhelp }

#-----------------------------------------

#-----------------------------------------
# Edit Controller
odr_record_edit:
    path:  /edit/{datarecord_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Edit:edit, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_key: '[^\/]*'
        offset: \d+

odr_record_reload_child:
    path: /edit/childreload/{child_datatype_id}/{parent_datarecord_id}
    defaults: { _controller: ODRAdminBundle:Edit:reloadchild }
    requirements:
        child_datatype_id: \d+
        parent_datarecord_id: \d+
odr_record_reload_datafield:
    path: /edit/datafieldreload/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:reloaddatafield }
    requirements:
        datarecord_id: \d+
        datafield_id: \d+
odr_record_reload_file_datafield:
    path: /edit/filedatafieldreload/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:reloadfiledatafield }
    requirements:
        datarecord_id: \d+
        datafield_id: \d+

odr_record_save:
#    path:  /edit/save/{record_type}/{datarecord_id}
    path:  /edit/save/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:update }
    requirements:
        datarecord_id:  \d+
        datafield_id_id:  \d+
#        record_type:  '[a-zA-Z]+'

odr_record_public:
    path:  /edit/publicdatarecord/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicdatarecord }
    requirements:
        datarecord_id:  \d+

odr_record_add:
    path:  /edit/adddatarecord/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Edit:adddatarecord }
    requirements:
        datatype_id:  \d+

odr_record_delete:
    path:  /edit/deletedatarecord/{datarecord_id}/{search_key}
    defaults: { _controller: ODRAdminBundle:Edit:deletedatarecord}
    requirements:
        datarecord_id:  \d+
        search_key: '[^\/]*'

odr_record_addchild:
    path:  /edit/addchilddatarecord/{datatype_id}/{parent_id}
    defaults: { _controller: ODRAdminBundle:Edit:addchildrecord }
    requirements:
        datatype_id:  \d+
        parent_id:  \d+

odr_record_deletechild:
    path:  /edit/deletechilddatarecord/{datarecord_id}
    defaults: { _controller: ODRAdminBundle:Edit:deletechildrecord }
    requirements:
        datarecord_id:  \d+

odr_record_radio_selection:
    path:  /edit/radioselection/{datarecord_id}/{datafield_id}/{radio_option_id}
    defaults: { _controller: ODRAdminBundle:Edit:radioselection }
    requirements:
        datarecord_id:  \d+
        datafield_id:  \d+
        radio_option_id:  \d+

odr_record_delete_file:
    path:  /edit/deletefile/{file_id}
    defaults: { _controller: ODRAdminBundle:Edit:deletefile }
    requirements:
        file_id:  \d+

odr_record_public_file:
    path:  /edit/publicfile/{file_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicfile }
    requirements:
        file_id:  \d+

odr_record_public_image:
    path:  /edit/publicimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Edit:publicimage }
    requirements:
        image_id:  \d+

odr_record_delete_image:
    path:  /edit/deleteimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Edit:deleteimage }
    requirements:
        image_id:  \d+

odr_record_rotate_image:
    path:  /edit/rotateimage/{image_id}/{direction}
    defaults: { _controller: ODRAdminBundle:Edit:rotateimage }
    requirements:
        image_id:  \d+
        direction: -1|1

odr_record_save_image_order:
    path:  /edit/saveimageorder
    defaults: { _controller: ODRAdminBundle:Edit:saveimageorder }
    methods: [ POST ]

odr_record_get_linkable_datarecords:
    path:  /edit/getlinkablerecords/{ancestor_datatype_id}/{descendant_datatype_id}/{local_datarecord_id}/{search_key}
    defaults: { _controller: ODRAdminBundle:Edit:getlinkabledatarecords, search_key: '' }
    requirements:
        ancestor_datatype_id:  \d+
        descendant_datatype_id:  \d+
        local_datarecord_id:  \d+
        search_key: '[^\/]*'


odr_link_datarecords:
    path:  /edit/linkrecords
    defaults: { _controller: ODRAdminBundle:Edit:linkdatarecords }
    methods: [ POST ]

odr_record_get_field_history:
    path:  /edit/history/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Edit:getfieldhistory }
    requirements:
        datarecord_id:  \d+
        datafield_id:  \d+

#-----------------------------------------

#-----------------------------------------
# Display Controller
odr_display_view:
    path:  /view/{datarecord_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:Display:view, search_key: '', offset: '' }
    requirements:
        datarecord_id:  \d+
        search_key: '[^\/]*'
        offset: \d+

odr_display_reload_datafield:
    path: /view/datafieldreload/{datarecord_id}/{datafield_id}/{theme_id}
    defaults: { _controller: ODRAdminBundle:Display:reloaddatafield }
    requirements:
        datarecord_id: \d+
        datafield_id: \d+
        theme_id: \d+

odr_file_download_start:
    path:  /view/downloadfilestart/{file_id}
    defaults: { _controller: ODRAdminBundle:Display:filedownloadstart }
    requirements:
        file_id:  \d+

odr_file_download:
    path:  /view/downloadfile/{file_id}
    defaults: { _controller: ODRAdminBundle:Display:filedownload }
    requirements:
        file_id:  \d+

odr_get_available_themes:
    path:  /view/getthemes/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Display:availablethemes }
    requirements:
        datatype_id:  \d+

# deprecated
# deprecated
#odr_cancel_file_decrypt:
#    path:  /view/downloadfile_cancel/{file_id}
#    defaults: { _controller: ODRAdminBundle:Display:cancelfiledecrypt }
#    requirements:
#        file_id:  \d+

odr_image_download:
    path:  /view/downloadimage/{image_id}
    defaults: { _controller: ODRAdminBundle:Display:imagedownload }
    requirements:
        image_id:  \d+

odr_get_file_list:
    path:  /view/file_list/{grandparent_datarecord_id}/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Display:listallfiles, datarecord_id: 0, datafield_id: 0 }
    requirements:
        grandparent_datarecord_id: \d+
        datarecord_id: \d+
        datafield_id: \d+

odr_start_zip_archive_download:
    path:  /view/start_archive_build/{grandparent_datarecord_id}
    defaults: { _controller: ODRAdminBundle:Display:startdownloadarchive }
    methods: [ POST ]
    requirements:
        grandparent_datarecord_id: \d+

odr_download_zip_archive:
    path:  /view/zip_archive_download/{archive_filename}
    defaults: { _controller: ODRAdminBundle:Display:downloadarchive }
    requirements:
        archive_filename: 0|[0-9a-zA-Z\-\_]{12}.zip

#-----------------------------------------

#-----------------------------------------
# TextResults Controller
odr_textresults_field_order:
    path:  /design/textresults/fieldorder/{unused_field_ids}/{used_field_ids}
    defaults: { _controller: ODRAdminBundle:TextResults:fieldorder }
    requirements:
        unused_field_ids: '[\d\,]*'
        used_field_ids: '[\d\,]*'

odr_datatables_row_request:
    path:  /beanstalk/datatables/rows
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesrowrequest }
    methods: [ POST ]

odr_datatables_state_save:
    path:  /beanstalk/datatables/state_save
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstatesave }
    methods: [ POST ]

odr_datatables_state_load:
    path:  /beanstalk/datatables/state_load
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstateload }
    methods: [ POST ]

odr_datatables_state_destroy:
    path:  /beanstalk/datatables/state_destroy/{odr_tab_id}
    defaults: { _controller: ODRAdminBundle:TextResults:datatablesstatedestroy }
    requirements:
        odr_tab_id: '[a-zA-Z0-9\-\_]{15}|'

#-----------------------------------------

#-----------------------------------------
# XSD Controller
odr_get_datatype_xsd:
    path:  /admin/schema/datatype/{version}/{datatype_id}
    defaults: { _controller: ODRAdminBundle:XSD:getDatatypeXSD }
    requirements:
        version: 'v1|v2'
        datatype_id: \d+

#-----------------------------------------

#-----------------------------------------
# XMLImport Controller
odr_xml_import:
    path:  /admin/xml_import/{datatype_id}
    defaults: { _controller: ODRAdminBundle:XMLImport:import }
    requirements:
        datatype_id:  \d+

odr_xml_import_start:
    path: /beanstalk/xml_import/start
    defaults: { _controller: ODRAdminBundle:XMLImport:importstart }
    methods: [ POST ]

odr_xml_import_validate:
    path: /beanstalk/xml_import/validate
    defaults: { _controller: ODRAdminBundle:XMLImport:importvalidate }
    methods: [ POST ]

odr_xml_import_worker:
    path: /beanstalk/xml_import/worker
    defaults: { _controller: ODRAdminBundle:XMLImport:importworker }
    methods: [ POST ]

odr_xml_import_file_download:
    path: /beanstalk/xml_import/download_file
    defaults: { _controller: ODRAdminBundle:XMLImport:importfile }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Worker Controller
odr_migrate_field:
    path: /beanstalk/migrate
    defaults: { _controller: ODRAdminBundle:Worker:migrate }
    methods: [ POST ]

#odr_start_rebuild_thumbnails:
#    path: /admin/rebuild_thumbnails/{datatype_id}
#    defaults: { _controller: ODRAdminBundle:Worker:startrebuildthumbnails }
#    requirements:
#        datatype_id: \d+

odr_rebuild_thumbnails:
    path: /beanstalk/rebuild_thumbnails
    defaults: { _controller: ODRAdminBundle:Worker:rebuildthumbnails }
    methods: [ POST ]

odr_crypto_request:
    path: /beanstalk/crypto_request
    defaults: { _controller: ODRAdminBundle:Worker:cryptorequest }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# CSVImport Controller
odr_csv_import:
    path: /edit/csv_import/{datatype_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:import }
    requirements:
        datatype_id: \d+

odr_csv_import_delimiter_changed:
    path: /edit/csv_import/delimiter/{delimiter}
    defaults: { _controller: ODRAdminBundle:CSVImport:delimiter }
    requirements:
        delimiter: 'tab|space|comma|semicolon|colon|pipe|'

odr_csv_file_redownload:
    path: /edit/csv_import/redownload
    defaults: { _controller: ODRAdminBundle:CSVImport:redownloadfile }

odr_csv_refresh_filelist:
    path: /edit/csv_import/filelist/refresh
    defaults: { _controller: ODRAdminBundle:CSVImport:refreshfilelist }
odr_csv_delete_filelist:
    path: /edit/csv_import/filelist/delete
    defaults: { _controller: ODRAdminBundle:CSVImport:deletefilelist }

odr_csv_cancel_import:
    path: /edit/csv_import/cancel
    defaults: { _controller: ODRAdminBundle:CSVImport:cancel }

odr_csv_import_layout:
    path: /edit/csv_import/layout/{source_datatype_id}/{target_datatype_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:layout }
    requirements:
        source_datatype_id: \d+
        target_datatype_id: \d+


odr_csv_import_start_validate:
    path: /edit/csv_import/start_validate
    defaults: { _controller: ODRAdminBundle:CSVImport:startvalidate }
    methods: [ POST ]

odr_csv_import_validate:
    path: /beanstalk/csv_import/validate
    defaults: { _controller: ODRAdminBundle:CSVImport:csvvalidate }
    methods: [ POST ]

odr_csv_import_validate_results:
    path: /beanstalk/csv_import/validate_results/{tracked_job_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:validateresults }
    requirements:
        tracked_job_id: \d+


odr_csv_import_start_worker:
    path: /edit/csv_import/start_worker/{job_id}
    defaults: { _controller: ODRAdminBundle:CSVImport:startworker }
#    requirements: { methods: POST }
    requirements:
        job_id: \d+

odr_csv_import_worker:
    path: /beanstalk/csv_import/worker
    defaults: { _controller: ODRAdminBundle:CSVImport:csvworker }
    methods: [ POST ]

odr_csv_link_worker:
    path: /beanstalk/csv_import/link_worker
    defaults: { _controller: ODRAdminBundle:CSVImport:csvlinkworker }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# Flow Controller
odr_flow_upload:
    path: /edit/flow/{upload_type}/{datatype_id}/{datarecord_id}/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Flow:flow, datarecord_id: 0, datafield_id: 0 }
    requirements:
        upload_type: 'xml|csv|file|image|csv_import_file_storage|xml_import_file_storage'
        datatype_id: \d+
        datarecord_id: \d+
        datafield_id: \d+

#-----------------------------------------

#-----------------------------------------
# MassEdit Controller
odr_mass_edit_render:
    path: /admin/massedit/{datatype_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:MassEdit:massEdit, offset: '' }
    requirements:
        datatype_id: \d+
        search_key: '[^\/]*'
        offset: \d+


odr_mass_update_start:
    path: /admin/massedit/start
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdate }
    methods: [ POST ]

odr_mass_update_worker_status:
    path: /beanstalk/massedit_status
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdateWorkerStatus }
    methods: [ POST ]

odr_mass_update_worker_values:
    path: /beanstalk/massedit_values
    defaults: { _controller: ODRAdminBundle:MassEdit:massUpdateWorkerValues }
    methods: [ POST ]

#-----------------------------------------

#-----------------------------------------
# CSVExport Controller
odr_csv_export_render:
    path: /admin/csvexport/{datatype_id}/{search_key}/{offset}
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExport, offset: '' }
    requirements:
        datatype_id: \d+
        search_key: '[^\/]*'
        offset: \d+


odr_csv_export_start:
    path: /admin/csvexport/start
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportStart }
    methods: [ POST ]

odr_csv_export_construct:
    path: /beanstalk/csvexport/construct
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportConstruct }
    methods: [ POST ]

odr_csv_export_worker:
    path: /beanstalk/csvexport/worker
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportWorker }
    methods: [ POST ]

odr_csv_export_finalize:
    path: /beanstalk/csvexport/finalize
    defaults: { _controller: ODRAdminBundle:CSVExport:csvExportFinalize }
    methods: [ POST ]


odr_csv_download:
    path:  /admin/csvexport/download/{user_id}/{tracked_job_id}
    defaults: { _controller: ODRAdminBundle:CSVExport:downloadCSV }
    requirements:
        user_id: \d+
        tracked_job_id: \d+

#-----------------------------------------

#-----------------------------------------
# Job Controller
odr_job_list:
    path:  /jobs/list
    defaults: { _controller: ODRAdminBundle:Job:list }

odr_job_refresh:
    path:  /jobs/refresh/{job_type}/{job_id}
    defaults: { _controller: ODRAdminBundle:Job:refresh, job_id: 0 }
    requirements:
        job_type: '|recache|migrate|mass_edit|rebuild_thumbnails|csv_import|csv_import_validate|csv_export'
        job_id: \d+

#odr_get_job_errors:
#    path:  /jobs/geterrors/{job_id}
#    defaults: { _controller: ODRAdminBundle:Job:getjoberrors }
#    requirements:
#        job_id: \d+

#odr_delete_job_errors:
#    path:  /jobs/delete_errors/{job_id}
#    defaults: { _controller: ODRAdminBundle:Job:deletejoberrors }
#    requirements:
#        job_id: \d+

odr_delete_tracked_job:
    path:  /jobs/delete_job/{job_id}
    defaults: { _controller: ODRAdminBundle:Job:deletejob }
    requirements:
        job_id: \d+

#-----------------------------------------

#-----------------------------------------
# Reports Controller
odr_design_analyze_datafield_unique:
    path:  /design/displaytemplate/analyze_datafield_unique/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldunique }
    requirements:
        datafield_id:  \d+

odr_design_analyze_file_uploads:
    path:  /design/displaytemplate/analyze_file_uploads/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzefileuploads }
    requirements:
        datafield_id:  \d+

odr_design_analyze_datarecord_number:
    path:  /design/displaytemplate/analyze_datarecord_number/{datatree_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatarecordnumber }
    requirements:
        datatree_id: \d+

odr_design_analyze_datarecord_links:
    path:  /design/displaytemplate/analyze_datarecord_links/{local_datatype_id}/{remote_datatype_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatarecordlinks }
    requirements:
        local_datatype_id: \d+
        remote_datatype_id: \d+

odr_design_analyze_datafield_content:
    path:  /edit/record/analyze_datafield_content/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzedatafieldcontent }
    requirements:
        datafield_id: \d+

odr_design_analyze_radio_selections:
    path:  /edit/record/analyze_radio_selections/{datafield_id}
    defaults: { _controller: ODRAdminBundle:Reports:analyzeradioselections }
    requirements:
        datafield_id: \d+

odr_get_file_decrypt_progress:
    path:  /view/decrypt_progress/file/{file_id}
    defaults: { _controller: ODRAdminBundle:Reports:getfiledecryptprogress }
    requirements:
        file_id: \d+

odr_get_file_encrypt_progress:
    path:  /view/encrypt_progress/file/{file_id}
    defaults: { _controller: ODRAdminBundle:Reports:getfileencryptprogress }
    requirements:
        file_id: \d+

odr_get_zip_archive_progress:
    path:  /view/zip_archive_progress/{archive_filename}
    defaults: { _controller: ODRAdminBundle:Reports:getziparchiveprogress }
    requirements:
        archive_filename: 0|[0-9a-zA-Z\-\_]{12}.zip

#-----------------------------------------

#-----------------------------------------
# Other stuff
odr_dt_clear:
    path: /admin/dt_clear/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Worker:dtclear, datatype_id: 0 }
    requirements:
        datatype_id: \d+
odr_dr_clear:
    path: /admin/dr_clear/{datatype_id}
    defaults: { _controller: ODRAdminBundle:Worker:drclear, datatype_id: 0 }
    requirements:
        datatype_id: \d+

odr_search_clear:
    path: /admin/search_clear
    defaults: { _controller: ODRAdminBundle:Worker:searchclear }

odr_permissions_clear:
    path: /admin/permissions_clear
    defaults: { _controller: ODRAdminBundle:Worker:permissionsclear }

#odr_mass_encrypt:
#    path: /admin/mass_encrypt/{object_type}
#    defaults: { _controller: ODRAdminBundle:Worker:startencrypt }
#    requirements:
#        object_type: 'file|File|image|Image'
#odr_force_encrypt:
#    path: /beanstalk/force_encrypt
#    defaults: { _controller: ODRAdminBundle:Worker:encrypt }
#    requirements: { methods: POST }

#odr_mass_decrypt:
#    path: /admin/mass_decrypt/{object_type}
#    defaults: { _controller: ODRAdminBundle:Worker:startdecrypt }
#    requirements:
#        object_type: 'file|File|image|Image'

odr_fix_database_dates:
    path: /admin/fix_dates
    defaults: { _controller: ODRAdminBundle:Worker:fixdatabasedates }

#-----------------------------------------

#-----------------------------------------
#build_group_data:
#    path:  /admin/build_group_data
#    defaults: { _controller:ODRAdminBundle:Worker:startbuildgroupdata }

#odr_group_metadata:
#    path:  /beanstalk/build_group_data
#    defaults: { _controller:ODRAdminBundle:Worker:buildgroupdata }
#    requirements: { methods: POST }


#-----------------------------------------
# API Controller
odr_api_userdata:
    path: /api/{version}/userdata.{_format}
    defaults: { _controller: ODRAdminBundle:API:userdata, _format: json }
    methods: [ GET ]
    requirements:
        version: 'v1'
        _format: '|json|xml'

odr_api_datatype_list:
    path: /api/{version}/databases.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatatypeList, _format: json }
    methods: [ GET ]
    requirements:
        version: 'v1'
        _format: '|json|xml'

odr_export_get_datatype_single:    # Alternate URL to use cookie authentication instead of OAuth token to get the single datatype export
    path:  /admin/datatype_export/{datatype_id}.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatatypeExport, version: 'v1', _format: json }
    methods: [ GET ]
    requirements:
        datatype_id: \d+
        _format: '|json|xml'

odr_api_get_datatype_single:
    path:  /api/{version}/databases/{datatype_id}.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatatypeExport, _format: json }
    methods: [ GET ]
    requirements:
        version: 'v1'
        datatype_id: \d+
        _format: '|json|xml'

odr_api_datarecord_list:
    path: /api/{version}/databases/{datatype_id}/records.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatarecordList, _format: json }
    methods: [ GET ]
    requirements:
        version: 'v1'
        datatype_id: \d+
        _format: '|json|xml'

odr_export_datarecord_single:    # Alternate URL to use cookie authentication instead of OAuth token to get the single datarecord export
    path: /admin/datarecord_export/{datarecord_id}.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatarecordExport, version: 'v1', _format: json }
    methods: [ GET ]
    requirements:
        datarecord_id: \d+
        _format: '|json|xml'

odr_api_get_datarecord_single:
    path:  /api/{version}/records/{datarecord_id}.{_format}
    defaults: { _controller: ODRAdminBundle:API:getDatarecordExport, _format: json }
    methods: [ GET ]
    requirements:
        version: 'v1'
        datarecord_id: \d+
        format: '|xml|json'

odr_api_download_file:
    path: /api/{version}/file_download/{file_id}
    defaults: { _controller: ODRAdminBundle:API:filedownload }
    methods: [ GET ]
    requirements:
        file_id: \d+

odr_api_download_image:
    path: /api/{version}/image_download/{image_id}
    defaults: { _controller: ODRAdminBundle:API:imagedownload }
    methods: [ GET ]
    requirements:
        image_id: \d+
