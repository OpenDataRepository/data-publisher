{% spaceless %}

{% if is_top_level == 1 %}
    <div id="DataType_{{ datatype.id }}" class="ODRDataType pure-u-1">
{% endif %}

{% if plugin_options.hide_datafields == "false" %}
    <div class="ODRGraphSpacer pure-u-1">
        {% include "ODRAdminBundle:Default:fieldarea_header.html.twig" with {
            'datatype': datatype,
            'datarecord_list': datarecord_array,

            'is_top_level': is_top_level,
            'is_link': is_link,
            'display_type': display_type
        } %}

        {% for dr_id, datarecord in datarecord_array %}

            {% include 'ODRAdminBundle:Display:accordion_header.html.twig' with {
                'datarecord': datarecord,
                'datatype': datatype,
                'is_top_level': is_top_level,
                'display_type': display_type
            } %}

            <div class="ODRFieldArea accordion-content pure-u-1" id="FieldArea_{{ datarecord.id }}">
                {% include "ODRAdminBundle:Display:display_fieldarea.html.twig" with {
                    'datatype_array': datatype_array,
                    'datarecord': datarecord,
                    'theme_array': theme_array,

                    'target_datatype_id': target_datatype_id,
                    'parent_datarecord_id': parent_datarecord_id,
                    'target_datarecord_id': datarecord.id,
                    'target_theme_id': target_theme_id,

                    'is_top_level': is_top_level,
                    'is_link': is_link,
                    'display_type': display_type
                } %}
            </div><!-- End of #FieldArea_{{ datarecord.id }} -->
        {% endfor %}

        {% include "ODRAdminBundle:Default:fieldarea_footer.html.twig" with {"display_type": display_type} %}
    </div>
{% endif %}

    <div class="ODRGraphSpacer pure-u-1">

        {% if is_top_level == 1 %}
            <div class="ODRFormAccordion">
                <div class="ODRFieldArea">
                    <div class="ODRThemeElement">
                        <div class="ODRInnerBox">
        {% endif %}

        {% include "ODROpenRepositoryGraphBundle:Base:Map/map.html.twig" with {
            'plugin_options': plugin_options,

            'gps_locations': gps_locations,
            'api_key': api_key,
            'unique_id': unique_id,
        } %}

        {% if is_top_level == 1 %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

{% if is_top_level == 1 %}
    </div><!-- end of #DataType_{{ datatype.id }} -->
{% endif %}

{% endspaceless %}
